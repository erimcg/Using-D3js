<!doctype html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">

  <title>Stacks</title>
  <link rel="canonical" href="http://using-d3js.com/05_06_stacks.html" />

  <link rel=stylesheet href="css/codemirror.css">
  <link rel=stylesheet href="css/ejs.css">

  <script src="js/acorn_codemirror.js"></script>
  <script src="js/sandbox.js"></script><script>var chapNum = 05;</script></head>

<article>
<nav><a href="05_05_areas.html" title="previous chapter">◀</a> <a href="index.html" title="cover">◆</a> <a href="05_07_arcs_pie_charts.html" title="next chapter">▶</a></nav>

<h1><span class=chap_num>Chapter 05</span>Stacks</h1><script src="https://unpkg.com/d3-area-label@1.5.0/build/d3-area-label.js"></script>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>
<script>
//This is the function that adds the axis to some of the stacks
function addAxis(svgSel, d, xscale, yscale, firstStack){
	let dates, maxPValues, maxNValues, blankAxis;
	
	if(d){
      dates = d.map( (d) => d.month );
      if(firstStack){
        maxPValues = d.map( (d) => {
            let sum = 0;
            for(let [key, value] of Object.entries(d)){ sum += key != "month" ? value : 0; }
            return sum;
         });
        maxNValues = [0,0]; 
      }
      else {
      	maxPValues = d.map( (d) => {
            let sum = 0;
            for(let [key, value] of Object.entries(d.fruitSales)){ sum += key != "month" ? (value > 0 ? value : 0): 0; }
            return sum;
         });
        maxPValues.push(0);
        
        maxNValues = d.map( (d) => {
            let sum = 0;
            for(let [key, value] of Object.entries(d.fruitSales)){ sum += key != "month" ? (value < 0 ? value : 0 ): 0; }
            return sum;
         });
        maxNValues.push(0);
        }
    }
    else{
    	dates = [0,0];
    	blankAxis = true;
        maxPValues = [0,0];
        maxNValues = [0,0];
    }
    
    if(xscale){
        xscale.domain([dates[0], dates[dates.length - 1]]);
        // Add xAxis
        let xAxis = d3.axisBottom(xscale)
        	.tickValues(blankAxis ? [] : dates)
        	.tickFormat(d3.timeFormat("%b"));
        svgSel.append("g")
            .attr("transform", "translate(0, 275)")
            .call(xAxis);
    }
    if(yscale){
        yDomain = d3.extent(maxPValues.concat(maxNValues));
        yscale.domain(yDomain);
        // Add yAxis
        let yAxis = d3.axisLeft(yscale)
            .ticks(8);
        svgSel.append("g")
            .attr("transform", "translate(49, 0)")
            .call(yAxis);
    }
}

//This function is used to add labels to all the areas
function addLabels(selection, data, area){
        selection.selectAll(".label")
            .data(data)
            .join("text")
            .text((d) => d.key)
            .attr("transform", d3.areaLabel(area).minHeight(9.5))
            .attr("fill", "black");
    }
    
function addAreas(selection, data, area, customTransform){ //customTransform not neccesary
    selection.selectAll(".areas")
        .data(data)
        .join("path")
        .attr("d", area)
        .attr("fill", (d) => colorScale(d.key))
        .attr("transform" , customTransform);
}
</script>


<p><a class="p_ident" id="p_NkA6nCK3Y8" href="#p_NkA6nCK3Y8" tabindex="-1" role="presentation"></a>When having multivariate data, it may be useful to show the data depicted as areas stacked on top of each other. Examples of this include <a href="https://bl.ocks.org/mbostock/1134768">stacked bar charts</a>, <a href="http://bl.ocks.org/anaeliaovalle/e57763e85def2a95be931c69eff6bfa6">stacked area graphs</a>, and <a href="http://bl.ocks.org/WillTurman/4631136">streamgraphs</a>.</p>

<p><a class="p_ident" id="p_k7t9w6qlzz" href="#p_k7t9w6qlzz" tabindex="-1" role="presentation"></a>Consider the following array containing sales data for three fruits over three months.</p><pre>
var data = [
  {month: new Date(2018, 1, 1), apples: 10, bananas: 20, oranges: 15},
  {month: new Date(2018, 2, 1), apples: 15, bananas: 15, oranges: 15},
  {month: new Date(2018, 3, 1), apples: 20, bananas: 25, oranges: 15}
];
</pre>


<p><a class="p_ident" id="p_Pqucundjj+" href="#p_Pqucundjj+" tabindex="-1" role="presentation"></a>This dataset has a form that is typically visualized using a stacked chart or graph.  The data for each fruit is referred to as a series.  For example, the data for apples is the series <code>(10, 15, 20)</code>. Each series can be displayed as an area, with one stacked on top of the other as shown in the visualization below.  The number of objects in each series determines the width of the areas.</p>

<pre class="snippet cm-s-default" data-language="html" data-edit="editable" data-cm="hidden" ><a class="c_ident" id="c_kszRkbGetF" href="#c_kszRkbGetF" tabindex="-1" role="presentation"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-keyword">var</span> <span class="cm-def">data</span> <span class="cm-operator">=</span> [
 {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span>), <span class="cm-property">apples</span>: <span class="cm-number">10</span>, <span class="cm-property">bananas</span>: <span class="cm-number">20</span>, <span class="cm-property">oranges</span>: <span class="cm-number">15</span>},
 {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">2</span>, <span class="cm-number">1</span>), <span class="cm-property">apples</span>: <span class="cm-number">15</span>, <span class="cm-property">bananas</span>: <span class="cm-number">15</span>, <span class="cm-property">oranges</span>: <span class="cm-number">15</span>},
 {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">3</span>, <span class="cm-number">1</span>), <span class="cm-property">apples</span>: <span class="cm-number">20</span>, <span class="cm-property">bananas</span>: <span class="cm-number">25</span>, <span class="cm-property">oranges</span>: <span class="cm-number">15</span>}
];

<span class="cm-keyword">var</span> <span class="cm-def">stackGen</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">stack</span>()
 .<span class="cm-property">keys</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>]);
   
<span class="cm-keyword">var</span> <span class="cm-def">stackedSeries</span> <span class="cm-operator">=</span> <span class="cm-variable">stackGen</span>(<span class="cm-variable">data</span>); 

<span class="cm-keyword">var</span> <span class="cm-def">xScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleTime</span>().<span class="cm-property">domain</span>([<span class="cm-variable">data</span>[<span class="cm-number">0</span>].<span class="cm-property">month</span>, <span class="cm-variable">data</span>[<span class="cm-number">2</span>].<span class="cm-property">month</span>]).<span class="cm-property">range</span>([<span class="cm-number">50</span>, <span class="cm-number">275</span>]);
<span class="cm-keyword">var</span> <span class="cm-def">yScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleLinear</span>().<span class="cm-property">domain</span>([<span class="cm-number">0</span>,<span class="cm-number">60</span>]).<span class="cm-property">range</span>([<span class="cm-number">275</span>, <span class="cm-number">25</span>]);

<span class="cm-variable">addAxis</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo0&quot;</span>), <span class="cm-variable">data</span>, <span class="cm-variable">xScale</span>, <span class="cm-variable">yScale</span>, <span class="cm-atom">true</span>); 

<span class="cm-keyword">var</span> <span class="cm-def">colorScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleOrdinal</span>()
 .<span class="cm-property">domain</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>])
 .<span class="cm-property">range</span>([<span class="cm-string">&quot;red&quot;</span>, <span class="cm-string">&quot;yellow&quot;</span>, <span class="cm-string">&quot;orange&quot;</span>]);

<span class="cm-keyword">var</span> <span class="cm-def">areaGen</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">area</span>()
 .<span class="cm-property">x</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">xScale</span>(<span class="cm-variable-2">d</span>.<span class="cm-property">data</span>.<span class="cm-property">month</span>))
 .<span class="cm-property">y0</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScale</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">0</span>]))
 .<span class="cm-property">y1</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScale</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">1</span>]));
   
<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo0&quot;</span>)
 .<span class="cm-property">selectAll</span>(<span class="cm-string">&quot;.areas&quot;</span>)
 .<span class="cm-property">data</span>(<span class="cm-variable">stackedSeries</span>)
 .<span class="cm-property">join</span>(<span class="cm-string">&quot;path&quot;</span>)
 .<span class="cm-property">attr</span>(<span class="cm-string">&quot;d&quot;</span>, <span class="cm-variable">areaGen</span>)
 .<span class="cm-property">attr</span>(<span class="cm-string">&quot;fill&quot;</span>, (<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">colorScale</span>(<span class="cm-variable-2">d</span>.<span class="cm-property">key</span>));
   
<span class="cm-variable">addLabels</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo0&quot;</span>), <span class="cm-variable">stackedSeries</span>, <span class="cm-variable">areaGen</span>);
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>

<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">svg</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;demo0&quot;</span> <span class="cm-attribute">width</span>= <span class="cm-string">&quot;300&quot;</span> <span class="cm-attribute">height</span>=<span class="cm-string">&quot;300&quot;</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">svg</span><span class="cm-tag cm-bracket">&gt;</span></pre><figure class="sandbox"><figcaption>Figure 1. A stacked area graph. </figcaption></figure>


<p><a class="p_ident" id="p_3LPXj78IDm" href="#p_3LPXj78IDm" tabindex="-1" role="presentation"></a>In order to create stacked areas we need to compute cumulative y-values for each data point in each series.  Let’s consider the stacked area graph shown above to see what we mean by <em>cumulative values</em>.</p>

<p><a class="p_ident" id="p_TjQ+1EEbQn" href="#p_TjQ+1EEbQn" tabindex="-1" role="presentation"></a>Notice that the visualization shows apples on the bottom, bananas in the middle, and oranges on top.  Also notice that the bottom line of the apple area is the x-axis, and that the bottom line of the other two areas is the top line of the area below it.  Therefore in order to define the areas we only need to compute the top lines of each area.  Since the top lines are line segments drawn from points at each month mark on the x-axis, we only need to compute the value of the top line at these points.</p>

<p><a class="p_ident" id="p_0swxUoSRAK" href="#p_0swxUoSRAK" tabindex="-1" role="presentation"></a>Let’s start at the bottom of the graph and work our way up.  Since the number of apples sold each month is depicted in the lower area, the y-coordinates of the points on the top line of the apple area are simply the values in the <code>apples</code> series.  For the next layer, bananas, at each month point, the y-coordinate of the point on the top line of the bananas area is the y-coordinate of the point on the top line of the apples area <em>plus</em> the respective value in the <code>bananas</code> series.  Similarly, at each time interval, the y-coordinate of the point on the top line of the oranges area is the y-coordinate of the point on the top line of the bananas area <em>plus</em> the respective value in the <code>oranges</code> series.</p>

<p><a class="p_ident" id="p_T5IFEgn23W" href="#p_T5IFEgn23W" tabindex="-1" role="presentation"></a>Thankfully, D3.js provides a stack generator that does this computation for us.</p>

<h2><a class="h_ident" id="h_JMM+nmfeGR" href="#h_JMM+nmfeGR" tabindex="-1" role="presentation"></a>Creating Stacks</h2>

<p><a class="p_ident" id="p_qxYyKsLos6" href="#p_qxYyKsLos6" tabindex="-1" role="presentation"></a>To create a stacked visualization using D3.js, we can use <code>d3.stack</code>, a method that returns a stack generator.</p>

<ul>

<li>

<p><a class="p_ident" id="p_PDoMYZocnC" href="#p_PDoMYZocnC" tabindex="-1" role="presentation"></a><a href="https://github.com/d3/d3-shape#stack">d3.stack()</a> - returns a stack generator.</p></li></ul>

<p><a class="p_ident" id="p_GpSSGPKpbf" href="#p_GpSSGPKpbf" tabindex="-1" role="presentation"></a>We may not want to create an area/layer for each series in the original dataset.  Therefore, when using <code>d3.stack</code>, we need to specify which properties (series) in the dataset to use.  We do so by using <code>stack.keys</code>.  When we call <code>d3.stack</code> to create the generator, we’ll chain a call to <code>stack.keys</code> passing to it an array of the strings, where each string is the name of a property that we want to create a layer for.</p>

<ul>

<li>

<p><a class="p_ident" id="p_V7tJO64Q66" href="#p_V7tJO64Q66" tabindex="-1" role="presentation"></a><a href="https://github.com/d3/d3-shape#stack_keys">stack.keys([keys])</a> - Takes an array of strings as an argument and returns the stack generator.</p></li></ul>

<p><a class="p_ident" id="p_S2PrQ38LOE" href="#p_S2PrQ38LOE" tabindex="-1" role="presentation"></a>For the dataset used in Figure 1, the keys are <code>apples</code>, <code>bananas</code>, and <code>oranges</code>, therefore to create a stack generator and assign the keys, we’ll do the following.</p><pre>
var stackGen = d3.stack()
  .keys(["apples", "bananas", "oranges"]);
</pre>


<p><a class="p_ident" id="p_dKZOa7fWBV" href="#p_dKZOa7fWBV" tabindex="-1" role="presentation"></a>After setting up the stack generator we invoke it, passing to it the dataset.</p><pre>
var stackedSeries = stackGen(data); 
</pre>


<ul>

<li>

<p><a class="p_ident" id="p_9auixy3TVT" href="#p_9auixy3TVT" tabindex="-1" role="presentation"></a><a href="https://github.com/d3/d3-shape#_stack">stack(data[,arguements])</a> - Takes an array of data as an argument and returns back an array of series data.</p></li></ul>

<p><a class="p_ident" id="p_43VGvWL1dz" href="#p_43VGvWL1dz" tabindex="-1" role="presentation"></a>When the stack generator is invoked with a dataset, it maps each series specified in <code>stack.keys</code> to a new series. Each new series contains the bottom and top y-coordinates for each data point in the original series, as well as reference to the object in the original dataset from which the top y-coordinate is computed.</p>

<p><a class="p_ident" id="p_e+/zvKf1aX" href="#p_e+/zvKf1aX" tabindex="-1" role="presentation"></a>The array referenced by <code>stackedSeries</code> holds the following data:</p><pre>
[
  [[0,  10, data[0]], [0,  15, data[1]], [0,  20, data[2]]],  //apples
  [[10, 30, data[0]], [15, 30, data[1]], [20, 45, data[2]]],  //bananas
  [[30, 45, data[0]], [30, 45, data[1]], [45, 60, data[2]]]   //oranges
]   
</pre>


<p><a class="p_ident" id="p_1cVe3Txopm" href="#p_1cVe3Txopm" tabindex="-1" role="presentation"></a>To render this data into stacked areas we need an area generator and some scales:</p><pre>
var xScale = d3.scaleTime()
  .domain([data[0].month, data[2].month])
  .range([50, 275]);
  
var yScale = d3.scaleLinear()
  .domain([0,60])
  .range([275, 25]);

var colorScale = d3.scaleOrdinal()
  .domain(["apples", "bananas", "oranges"])
  .range(["red", "yellow", "orange"]);

var areaGen = d3.area()
  .x((d) => xScale(d.data.month))
  .y0((d) => yScale(d[0]))
  .y1((d) => yScale(d[1]));
</pre>


<p><a class="p_ident" id="p_EqVy8RXDV4" href="#p_EqVy8RXDV4" tabindex="-1" role="presentation"></a>Now we can use the <code>stackedSeries</code> data with our <code>areaGen</code> to create multiple SVG paths which are filled with different colors.</p><pre>
d3.select("#demo1")
  .selectAll(".areas")
  .data(stackedSeries)
  .join("path")
  .attr("d", areaGen)
  .attr("fill", (d) => colorScale(d.key));
</pre>


<pre class="snippet cm-s-default" data-language="html" data-edit="editable" data-cm="hidden" ><a class="c_ident" id="c_wu0juamUHj" href="#c_wu0juamUHj" tabindex="-1" role="presentation"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-keyword">var</span> <span class="cm-def">data</span> <span class="cm-operator">=</span> [
 {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span>), <span class="cm-property">apples</span>: <span class="cm-number">10</span>, <span class="cm-property">bananas</span>: <span class="cm-number">20</span>, <span class="cm-property">oranges</span>: <span class="cm-number">15</span>},
 {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">2</span>, <span class="cm-number">1</span>), <span class="cm-property">apples</span>: <span class="cm-number">15</span>, <span class="cm-property">bananas</span>: <span class="cm-number">15</span>, <span class="cm-property">oranges</span>: <span class="cm-number">15</span>},
 {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">3</span>, <span class="cm-number">1</span>), <span class="cm-property">apples</span>: <span class="cm-number">20</span>, <span class="cm-property">bananas</span>: <span class="cm-number">25</span>, <span class="cm-property">oranges</span>: <span class="cm-number">15</span>}
];

<span class="cm-keyword">var</span> <span class="cm-def">stackGen</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">stack</span>()
 .<span class="cm-property">keys</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>]);
   
<span class="cm-keyword">var</span> <span class="cm-def">stackedSeries</span> <span class="cm-operator">=</span> <span class="cm-variable">stackGen</span>(<span class="cm-variable">data</span>);

<span class="cm-keyword">var</span> <span class="cm-def">xScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleTime</span>().<span class="cm-property">domain</span>([<span class="cm-variable">data</span>[<span class="cm-number">0</span>].<span class="cm-property">month</span>, <span class="cm-variable">data</span>[<span class="cm-number">2</span>].<span class="cm-property">month</span>]).<span class="cm-property">range</span>([<span class="cm-number">50</span>, <span class="cm-number">275</span>]);
<span class="cm-keyword">var</span> <span class="cm-def">yScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleLinear</span>().<span class="cm-property">domain</span>([<span class="cm-number">0</span>,<span class="cm-number">60</span>]).<span class="cm-property">range</span>([<span class="cm-number">275</span>, <span class="cm-number">25</span>]);

<span class="cm-keyword">var</span> <span class="cm-def">colorScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleOrdinal</span>()
 .<span class="cm-property">domain</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>])
 .<span class="cm-property">range</span>([<span class="cm-string">&quot;red&quot;</span>, <span class="cm-string">&quot;yellow&quot;</span>, <span class="cm-string">&quot;orange&quot;</span>]);

<span class="cm-keyword">var</span> <span class="cm-def">areaGen</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">area</span>()
 .<span class="cm-property">x</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">xScale</span>(<span class="cm-variable-2">d</span>.<span class="cm-property">data</span>.<span class="cm-property">month</span>))
 .<span class="cm-property">y0</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScale</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">0</span>]))
 .<span class="cm-property">y1</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScale</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">1</span>]));
   
<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo1&quot;</span>)
 .<span class="cm-property">selectAll</span>(<span class="cm-string">&quot;.areas&quot;</span>)
 .<span class="cm-property">data</span>(<span class="cm-variable">stackedSeries</span>)
 .<span class="cm-property">join</span>(<span class="cm-string">&quot;path&quot;</span>)
 .<span class="cm-property">attr</span>(<span class="cm-string">&quot;d&quot;</span>, <span class="cm-variable">areaGen</span>)
 .<span class="cm-property">attr</span>(<span class="cm-string">&quot;fill&quot;</span>, (<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">colorScale</span>(<span class="cm-variable-2">d</span>.<span class="cm-property">key</span>));
   
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>

<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">svg</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;demo1&quot;</span> <span class="cm-attribute">width</span>= <span class="cm-string">&quot;300&quot;</span> <span class="cm-attribute">height</span>=<span class="cm-string">&quot;300&quot;</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">svg</span><span class="cm-tag cm-bracket">&gt;</span></pre><figure class="sandbox"><figcaption>Figure 2. A basic stacked area graph. </figcaption></figure>


<h3><a class="i_ident" id="i_2LwQu1N6r4" href="#i_2LwQu1N6r4" tabindex="-1" role="presentation"></a>Stack.value()</h3>

<p><a class="p_ident" id="p_C1KkbaYwZL" href="#p_C1KkbaYwZL" tabindex="-1" role="presentation"></a>The <code>stack.value</code> method is used to retrieve the values associated with the keys from the data passed to the stack generator. By default, <code>stack.value</code> does not need to be called, as the keys are assumed to be properties of the objects in the array passed to the stack generator.</p>

<ul>

<li>

<p><a class="p_ident" id="p_WWtQa11+mb" href="#p_WWtQa11+mb" tabindex="-1" role="presentation"></a><a href="https://github.com/d3/d3-shape#stack_value">stack.value([value])</a> - Takes a function that returns the value associated with a key.</p></li></ul>

<p><a class="p_ident" id="p_ux379/hWEV" href="#p_ux379/hWEV" tabindex="-1" role="presentation"></a>To see how <code>stack.value</code> can be used, consider a dataset formatted as follows:</p><pre>
var data = [
  {month: new Date(2018, 1, 1), fruitSales: {apples: 10, bananas: 20, oranges: 15}},
  ...
</pre>


<p><a class="p_ident" id="p_wqmC6ZaBvi" href="#p_wqmC6ZaBvi" tabindex="-1" role="presentation"></a>To create a stack generator with this dataset we call <code>d3.stack</code> and then set the keys to the names of the fruits as we did in the previous examples.  We then call <code>stack.value</code>, passing it a lambda expression.  The lambda expression has two parameters, <code>obj</code> and <code>key</code>, which correspond to an object in <code>data</code> and a key passed to <code>stack.keys</code>, respectively, and returns the value associated with the <code>key</code> in the object <code>obj</code>.</p><pre>
var stack = d3.stack()
  .keys(["apples", "bananas", "oranges"])
  .value((obj, key) => obj.fruitSales[key]);
</pre>


<pre class="snippet cm-s-default" data-language="html" data-edit="editable" data-cm="hidden" ><a class="c_ident" id="c_Co+wms3zpf" href="#c_Co+wms3zpf" tabindex="-1" role="presentation"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-keyword">var</span> <span class="cm-def">data</span> <span class="cm-operator">=</span> [
  {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">10</span>, <span class="cm-property">bananas</span>: <span class="cm-number">20</span>, <span class="cm-property">oranges</span>: <span class="cm-number">15</span>}},
  {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">2</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">15</span>, <span class="cm-property">bananas</span>: <span class="cm-number">15</span>, <span class="cm-property">oranges</span>: <span class="cm-number">15</span>}},
  {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">3</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">20</span>, <span class="cm-property">bananas</span>: <span class="cm-number">25</span>, <span class="cm-property">oranges</span>: <span class="cm-number">15</span>}}
];

<span class="cm-keyword">var</span> <span class="cm-def">stack</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">stack</span>()
  .<span class="cm-property">keys</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>])
  .<span class="cm-property">value</span>((<span class="cm-def">obj</span>, <span class="cm-def">key</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">obj</span>.<span class="cm-property">fruitSales</span>[<span class="cm-variable-2">key</span>]);

<span class="cm-keyword">var</span> <span class="cm-def">stackedSeries</span> <span class="cm-operator">=</span> <span class="cm-variable">stack</span>(<span class="cm-variable">data</span>);

<span class="cm-keyword">var</span> <span class="cm-def">xScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleTime</span>().<span class="cm-property">domain</span>([<span class="cm-variable">data</span>[<span class="cm-number">0</span>].<span class="cm-property">month</span>, <span class="cm-variable">data</span>[<span class="cm-number">2</span>].<span class="cm-property">month</span>]).<span class="cm-property">range</span>([<span class="cm-number">50</span>, <span class="cm-number">275</span>]);
<span class="cm-keyword">var</span> <span class="cm-def">yScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleLinear</span>().<span class="cm-property">domain</span>([<span class="cm-number">0</span>,<span class="cm-number">60</span>]).<span class="cm-property">range</span>([<span class="cm-number">275</span>, <span class="cm-number">25</span>]);

<span class="cm-keyword">var</span> <span class="cm-def">colorScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleOrdinal</span>()
  .<span class="cm-property">domain</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>])
  .<span class="cm-property">range</span>([<span class="cm-string">&quot;red&quot;</span>, <span class="cm-string">&quot;yellow&quot;</span>, <span class="cm-string">&quot;orange&quot;</span>]);

<span class="cm-keyword">var</span> <span class="cm-def">areaGen</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">area</span>()
  .<span class="cm-property">x</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">xScale</span>(<span class="cm-variable-2">d</span>.<span class="cm-property">data</span>.<span class="cm-property">month</span>))
  .<span class="cm-property">y0</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScale</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">0</span>]))
  .<span class="cm-property">y1</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScale</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">1</span>]));
    
<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo3&quot;</span>)
  .<span class="cm-property">selectAll</span>(<span class="cm-string">&quot;.areas&quot;</span>)
  .<span class="cm-property">data</span>(<span class="cm-variable">stackedSeries</span>)
  .<span class="cm-property">join</span>(<span class="cm-string">&quot;path&quot;</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">&quot;d&quot;</span>, <span class="cm-variable">areaGen</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">&quot;fill&quot;</span>, (<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">colorScale</span>(<span class="cm-variable-2">d</span>.<span class="cm-property">key</span>));
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>

<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">svg</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;demo3&quot;</span> <span class="cm-attribute">width</span>=<span class="cm-string">&quot;300&quot;</span> <span class="cm-attribute">height</span>=<span class="cm-string">&quot;300&quot;</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">svg</span><span class="cm-tag cm-bracket">&gt;</span></pre><figure class="sandbox"><figcaption>Figure 3. A stacked graph using stack.value(). </figcaption></figure>


<h2><a class="h_ident" id="h_eNaZZ8M/VZ" href="#h_eNaZZ8M/VZ" tabindex="-1" role="presentation"></a>Creating Bar Graphs</h2>

<p><a class="p_ident" id="p_PtlFVaLeVN" href="#p_PtlFVaLeVN" tabindex="-1" role="presentation"></a>Instead of appending areas we can append SVG rects to create stacked bar graphs.</p>

<p><a class="p_ident" id="p_lt+uIPu/s7" href="#p_lt+uIPu/s7" tabindex="-1" role="presentation"></a>To do this, we will first bind each of the series in <code>stackedSeries</code> to a new <code>g</code> elements in our SVG.  This gives us a <code>g</code> element for each fruit.</p><pre>
var sel = d3.select("#demo2")
  .select('g')
  .selectAll('g.series')
  .data(stackedSeries)
  .join('g')
  .classed('series', true)
  .style('fill', (d) => colorScale(d.key));
</pre>


<p><a class="p_ident" id="p_A1dibVeRIT" href="#p_A1dibVeRIT" tabindex="-1" role="presentation"></a>Recall that each series in <code>stackedSeries</code> is an array containing arrays where each inner array contains low and high y-coordinates.</p>

<p><a class="p_ident" id="p_78o3xHEYVO" href="#p_78o3xHEYVO" tabindex="-1" role="presentation"></a>Then, for each <code>g</code> element, we append multiple <code>rect</code> element, one for each pair of low and high y-coordinates.</p><pre>
sel.selectAll('rect')
  .data((d) => d)
  .join('rect')
  .attr('width', 40)
  .attr('y', (d) => yScale(d[1]))
  .attr('x', (d) => xScale(d.data.month) - 20)
  .attr('height', (d) => yScale(d[0]) -  yScale(d[1]));
</pre>


<p><a class="p_ident" id="p_9/TJ4Rw0ek" href="#p_9/TJ4Rw0ek" tabindex="-1" role="presentation"></a>Note that we use functions to generate our axis, labels, and areas in the example below and in many other examples on this page. The definitions of these functions can be found at the bottom of this page.</p>

<pre class="snippet cm-s-default" data-language="html" data-edit="editable" data-cm="hidden" ><a class="c_ident" id="c_ttyEm2gRcL" href="#c_ttyEm2gRcL" tabindex="-1" role="presentation"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-keyword">var</span> <span class="cm-def">data</span> <span class="cm-operator">=</span> [
  {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span>), <span class="cm-property">apples</span>: <span class="cm-number">400</span>, <span class="cm-property">bananas</span>: <span class="cm-number">200</span>, <span class="cm-property">cherries</span>: <span class="cm-number">96</span>, <span class="cm-property">dates</span>: <span class="cm-number">40</span>},
  {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">2</span>, <span class="cm-number">1</span>), <span class="cm-property">apples</span>: <span class="cm-number">160</span>, <span class="cm-property">bananas</span>: <span class="cm-number">150</span>, <span class="cm-property">cherries</span>: <span class="cm-number">96</span>, <span class="cm-property">dates</span>: <span class="cm-number">40</span>},
  {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">3</span>, <span class="cm-number">1</span>), <span class="cm-property">apples</span>:  <span class="cm-number">64</span>, <span class="cm-property">bananas</span>:  <span class="cm-number">96</span>, <span class="cm-property">cherries</span>: <span class="cm-number">64</span>, <span class="cm-property">dates</span>: <span class="cm-number">40</span>},
  {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">4</span>, <span class="cm-number">1</span>), <span class="cm-property">apples</span>:  <span class="cm-number">32</span>, <span class="cm-property">bananas</span>:  <span class="cm-number">48</span>, <span class="cm-property">cherries</span>: <span class="cm-number">64</span>, <span class="cm-property">dates</span>: <span class="cm-number">40</span>}
];

<span class="cm-keyword">var</span> <span class="cm-def">stack</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">stack</span>()
  .<span class="cm-property">keys</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;cherries&quot;</span>, <span class="cm-string">&quot;dates&quot;</span>]);
  
<span class="cm-keyword">var</span> <span class="cm-def">stackedSeries</span> <span class="cm-operator">=</span> <span class="cm-variable">stack</span>(<span class="cm-variable">data</span>);

<span class="cm-keyword">var</span> <span class="cm-def">xScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleTime</span>().<span class="cm-property">domain</span>([<span class="cm-variable">data</span>[<span class="cm-number">0</span>].<span class="cm-property">month</span>, <span class="cm-variable">data</span>[<span class="cm-number">3</span>].<span class="cm-property">month</span>]).<span class="cm-property">range</span>([<span class="cm-number">50</span>,<span class="cm-number">235</span>]);
<span class="cm-keyword">var</span> <span class="cm-def">yScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleLinear</span>().<span class="cm-property">domain</span>([<span class="cm-number">0</span>, <span class="cm-number">650</span>]).<span class="cm-property">range</span>([<span class="cm-number">275</span>,<span class="cm-number">25</span>]);
<span class="cm-keyword">var</span> <span class="cm-def">colorScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleOrdinal</span>()
  .<span class="cm-property">domain</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>, <span class="cm-string">&quot;cherries&quot;</span>, <span class="cm-string">&quot;grapes&quot;</span>, <span class="cm-string">&quot;dates&quot;</span>])
  .<span class="cm-property">range</span>([<span class="cm-string">&quot;red&quot;</span>, <span class="cm-string">&quot;yellow&quot;</span>, <span class="cm-string">&quot;orange&quot;</span>, <span class="cm-string">&quot;pink&quot;</span>, <span class="cm-string">&quot;purple&quot;</span>, <span class="cm-string">&quot;brown&quot;</span>]);
        
<span class="cm-comment">//See end of page for addAxis() function definition</span>
<span class="cm-variable">addAxis</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo2&quot;</span>).<span class="cm-property">append</span>(<span class="cm-string">&quot;g&quot;</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">&quot;transform&quot;</span>, <span class="cm-string">&quot;translate(20,0)&quot;</span>), <span class="cm-variable">data</span>, <span class="cm-variable">xScale</span>, <span class="cm-atom">null</span>, <span class="cm-atom">true</span>);    <span class="cm-comment">//Adds in the X axis with ticks</span>
<span class="cm-variable">addAxis</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo2&quot;</span>), <span class="cm-variable">data</span>, <span class="cm-atom">null</span>, <span class="cm-variable">yScale</span>, <span class="cm-atom">true</span>);                  <span class="cm-comment">//Adds in the Y axis</span>
<span class="cm-variable">addAxis</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo2&quot;</span>), <span class="cm-atom">null</span>, <span class="cm-variable">d3</span>.<span class="cm-property">scaleLinear</span>().<span class="cm-property">range</span>([<span class="cm-number">50</span>,<span class="cm-number">275</span>]), <span class="cm-atom">null</span>, <span class="cm-atom">true</span>);  <span class="cm-comment">//Adds in a blank X axis</span>
        
<span class="cm-comment">// Create a g element for each series</span>
<span class="cm-keyword">var</span> <span class="cm-def">sel</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo2&quot;</span>)
  .<span class="cm-property">select</span>(<span class="cm-string">'g'</span>)
  .<span class="cm-property">selectAll</span>(<span class="cm-string">'g.series'</span>)
  .<span class="cm-property">data</span>(<span class="cm-variable">stackedSeries</span>)
  .<span class="cm-property">join</span>(<span class="cm-string">'g'</span>)
  .<span class="cm-property">classed</span>(<span class="cm-string">'series'</span>, <span class="cm-atom">true</span>)
  .<span class="cm-property">style</span>(<span class="cm-string">'fill'</span>, (<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">colorScale</span>(<span class="cm-variable-2">d</span>.<span class="cm-property">key</span>));

<span class="cm-comment">// For each series create a rect element for each month</span>
<span class="cm-variable">sel</span>.<span class="cm-property">selectAll</span>(<span class="cm-string">'rect'</span>)
  .<span class="cm-property">data</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">d</span>)
  .<span class="cm-property">join</span>(<span class="cm-string">'rect'</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">'width'</span>, <span class="cm-number">40</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">'y'</span>, (<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScale</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">1</span>]))
  .<span class="cm-property">attr</span>(<span class="cm-string">'x'</span>, (<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">xScale</span>(<span class="cm-variable-2">d</span>.<span class="cm-property">data</span>.<span class="cm-property">month</span>) <span class="cm-operator">-</span> <span class="cm-number">20</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">'height'</span>, (<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScale</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">0</span>]) <span class="cm-operator">-</span>  <span class="cm-variable">yScale</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">1</span>]));
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>

<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">svg</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;demo2&quot;</span> <span class="cm-attribute">width</span>=<span class="cm-string">&quot;300&quot;</span> <span class="cm-attribute">height</span>=<span class="cm-string">&quot;300&quot;</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">svg</span><span class="cm-tag cm-bracket">&gt;</span></pre><figure class="sandbox"><figcaption>Figure 4. A stacked bar graph. </figcaption></figure>


<h2><a class="h_ident" id="h_ZgX4slNPRc" href="#h_ZgX4slNPRc" tabindex="-1" role="presentation"></a>Stack Ordering</h2>

<p><a class="p_ident" id="p_PEBwBhE+VN" href="#p_PEBwBhE+VN" tabindex="-1" role="presentation"></a>By calling <code>stack.<wbr>order([order])</code> on a stack generator we can change the order of the series in the array that is returned by the stack generator. The default ordering is <code>d3.<wbr>stackOrderNone</code>, which orders the series in the same order as that of the keys.</p>

<ul>

<li>

<p><a class="p_ident" id="p_sA9bDNJnL+" href="#p_sA9bDNJnL+" tabindex="-1" role="presentation"></a><a href="https://github.com/d3/d3-shape#stack_order">stack.order([order])</a> - Takes an ordering function as an argument and returns the stack generator.</p></li></ul>

<p><a class="p_ident" id="p_OQydoe0P02" href="#p_OQydoe0P02" tabindex="-1" role="presentation"></a>If the stack generator has a non-default ordering, we can change the ordering to the default by using <code>d3.<wbr>stackOrderNone</code>.</p>

<ul>

<li>

<p><a class="p_ident" id="p_cvrPPJ7QE3" href="#p_cvrPPJ7QE3" tabindex="-1" role="presentation"></a><a href="https://github.com/d3/d3-shape#stackOrderNone">d3.stackOrderNone(series)</a> - Orders the series based on the ordering of the keys as defined by <code>stack.keys</code>.   For example, if you define the stack with <code>.<wbr>keys([&quot;a&quot;, &quot;b&quot;, &quot;c&quot;])</code> the order of the series will be “a”, “b”, “c”, from bottom to top.</p></li></ul>

<p><a class="p_ident" id="p_Bk3LXEEHo1" href="#p_Bk3LXEEHo1" tabindex="-1" role="presentation"></a>If we want an ordering that is the reverse of the default, we can use <code>d3.<wbr>stackOrderReverse</code>.</p>

<ul>

<li>

<p><a class="p_ident" id="p_a9cri4OX4g" href="#p_a9cri4OX4g" tabindex="-1" role="presentation"></a><a href="https://github.com/d3/d3-shape#stackOrderReverse">d3.stackOrderReverse(series)</a> - Orders the series based on the <b>reverse</b> ordering of the keys.  For example, if you define the stack with <code>.<wbr>keys([&quot;a&quot;, &quot;b&quot;, &quot;c&quot;])</code> the order of the series will be “c”, “b”, “a”, from bottom to top.</p></li></ul>

<pre class="snippet cm-s-default" data-language="html" data-edit="editable" data-cm="hidden" ><a class="c_ident" id="c_iqXuTTteSg" href="#c_iqXuTTteSg" tabindex="-1" role="presentation"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>
    <span class="cm-keyword">var</span> <span class="cm-def">data</span> <span class="cm-operator">=</span> [
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">0</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">400</span>, <span class="cm-property">bananas</span>: <span class="cm-number">200</span>, <span class="cm-property">cherries</span>: <span class="cm-number">96</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">250</span>, <span class="cm-property">grapes</span>: <span class="cm-number">20</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">160</span>, <span class="cm-property">bananas</span>: <span class="cm-number">150</span>, <span class="cm-property">cherries</span>: <span class="cm-number">96</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">200</span>, <span class="cm-property">grapes</span>: <span class="cm-number">25</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">2</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>:  <span class="cm-number">64</span>, <span class="cm-property">bananas</span>:  <span class="cm-number">96</span>, <span class="cm-property">cherries</span>: <span class="cm-number">64</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">150</span>, <span class="cm-property">grapes</span>: <span class="cm-number">30</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">3</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>:  <span class="cm-number">32</span>, <span class="cm-property">bananas</span>:  <span class="cm-number">48</span>, <span class="cm-property">cherries</span>: <span class="cm-number">64</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">100</span>, <span class="cm-property">grapes</span>: <span class="cm-number">20</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">4</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>:  <span class="cm-number">40</span>, <span class="cm-property">bananas</span>: <span class="cm-number">100</span>, <span class="cm-property">cherries</span>: <span class="cm-number">64</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">115</span>, <span class="cm-property">grapes</span>: <span class="cm-number">45</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">5</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">100</span>, <span class="cm-property">bananas</span>: <span class="cm-number">250</span>, <span class="cm-property">cherries</span>: <span class="cm-number">86</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">225</span>, <span class="cm-property">grapes</span>: <span class="cm-number">50</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">6</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">150</span>, <span class="cm-property">bananas</span>: <span class="cm-number">125</span>, <span class="cm-property">cherries</span>: <span class="cm-number">96</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">200</span>, <span class="cm-property">grapes</span>: <span class="cm-number">15</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">7</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">100</span>, <span class="cm-property">bananas</span>:  <span class="cm-number">75</span>, <span class="cm-property">cherries</span>: <span class="cm-number">106</span>, <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">210</span>, <span class="cm-property">grapes</span>: <span class="cm-number">10</span>}}
    ];

    <span class="cm-keyword">var</span> <span class="cm-def">xScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleTime</span>().<span class="cm-property">domain</span>([<span class="cm-variable">data</span>[<span class="cm-number">0</span>].<span class="cm-property">month</span>, <span class="cm-variable">data</span>[<span class="cm-variable">data</span>.<span class="cm-property">length</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>].<span class="cm-property">month</span>]).<span class="cm-property">range</span>([<span class="cm-number">50</span>,<span class="cm-number">275</span>]);
    <span class="cm-keyword">var</span> <span class="cm-def">yScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleLinear</span>().<span class="cm-property">domain</span>([<span class="cm-number">0</span>,<span class="cm-number">1000</span>]).<span class="cm-property">range</span>([<span class="cm-number">275</span>,<span class="cm-number">25</span>]);
    <span class="cm-keyword">var</span> <span class="cm-def">colorScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleOrdinal</span>()
        .<span class="cm-property">domain</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;cherries&quot;</span>, <span class="cm-string">&quot;dates&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>, <span class="cm-string">&quot;grapes&quot;</span>])
        .<span class="cm-property">range</span>([<span class="cm-string">&quot;red&quot;</span>, <span class="cm-string">&quot;yellow&quot;</span>, <span class="cm-string">&quot;pink&quot;</span>, <span class="cm-string">&quot;brown&quot;</span>, <span class="cm-string">&quot;orange&quot;</span>, <span class="cm-string">&quot;purple&quot;</span>]);

    <span class="cm-keyword">var</span> <span class="cm-def">stack1</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">stack</span>() 
            .<span class="cm-property">keys</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;cherries&quot;</span>, <span class="cm-string">&quot;dates&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>, <span class="cm-string">&quot;grapes&quot;</span>])
            .<span class="cm-property">value</span>((<span class="cm-def">d</span>, <span class="cm-def">key</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">d</span>.<span class="cm-property">fruitSales</span>[<span class="cm-variable-2">key</span>])
            .<span class="cm-property">order</span>(<span class="cm-variable">d3</span>.<span class="cm-property">stackOrderNone</span>)
            .<span class="cm-property">offset</span>(<span class="cm-variable">d3</span>.<span class="cm-property">stackOffsetNone</span>);
            
    <span class="cm-keyword">var</span> <span class="cm-def">stackedSeries1</span> <span class="cm-operator">=</span> <span class="cm-variable">stack1</span>(<span class="cm-variable">data</span>);

    <span class="cm-keyword">var</span> <span class="cm-def">stack2</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">stack</span>()
            .<span class="cm-property">keys</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;cherries&quot;</span>, <span class="cm-string">&quot;dates&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>, <span class="cm-string">&quot;grapes&quot;</span>])
            .<span class="cm-property">value</span>((<span class="cm-def">d</span>, <span class="cm-def">key</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">d</span>.<span class="cm-property">fruitSales</span>[<span class="cm-variable-2">key</span>])
            .<span class="cm-property">order</span>(<span class="cm-variable">d3</span>.<span class="cm-property">stackOrderReverse</span>)
            .<span class="cm-property">offset</span>(<span class="cm-variable">d3</span>.<span class="cm-property">stackOffsetNone</span>);
    <span class="cm-keyword">var</span> <span class="cm-def">stackedSeries2</span> <span class="cm-operator">=</span> <span class="cm-variable">stack2</span>(<span class="cm-variable">data</span>);

    <span class="cm-keyword">var</span> <span class="cm-def">area</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">area</span>()
        .<span class="cm-property">x</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">xScale</span>(<span class="cm-variable-2">d</span>.<span class="cm-property">data</span>.<span class="cm-property">month</span>))
        .<span class="cm-property">y0</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScale</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">0</span>]))
        .<span class="cm-property">y1</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScale</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">1</span>]))
        .<span class="cm-property">curve</span>(<span class="cm-variable">d3</span>.<span class="cm-property">curveBasis</span>);
                
    <span class="cm-variable">addAreas</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo4n&quot;</span>), <span class="cm-variable">stackedSeries1</span>, <span class="cm-variable">area</span>); <span class="cm-comment">// Areas to stackOrderNone</span>
    <span class="cm-variable">addAreas</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo4r&quot;</span>), <span class="cm-variable">stackedSeries2</span>, <span class="cm-variable">area</span>); <span class="cm-comment">// Areas to stackOrderReverse</span>
     
    <span class="cm-variable">addLabels</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo4n&quot;</span>), <span class="cm-variable">stackedSeries1</span>, <span class="cm-variable">area</span>) <span class="cm-comment">// Labels to stackOrderNone</span>
    <span class="cm-variable">addLabels</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo4r&quot;</span>), <span class="cm-variable">stackedSeries2</span>, <span class="cm-variable">area</span>) <span class="cm-comment">// Labels to stackOrderReverse</span>
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>

<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">svg</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;demo4n&quot;</span> <span class="cm-attribute">width</span>=<span class="cm-string">&quot;300&quot;</span> <span class="cm-attribute">height</span>=<span class="cm-string">&quot;300&quot;</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">svg</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">svg</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;demo4r&quot;</span> <span class="cm-attribute">width</span>=<span class="cm-string">&quot;300&quot;</span> <span class="cm-attribute">height</span>=<span class="cm-string">&quot;300&quot;</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">svg</span><span class="cm-tag cm-bracket">&gt;</span></pre><figure class="sandbox"><figcaption>Figure 5. Stacks using d3.stackOffsetNone (left) and d3.stackOrderReverse (right). </figcaption></figure>


<h3><a class="i_ident" id="i_q+J+Of+VL5" href="#i_q+J+Of+VL5" tabindex="-1" role="presentation"></a>Ordering based on the sum of the values in each series</h3>

<p><a class="p_ident" id="p_0RUw4AWSoD" href="#p_0RUw4AWSoD" tabindex="-1" role="presentation"></a>D3.js provides two orderings that are based on the sum of the values in each series.</p>

<ul>

<li>

<p><a class="p_ident" id="p_5mY3b0i1JF" href="#p_5mY3b0i1JF" tabindex="-1" role="presentation"></a><a href="https://github.com/d3/d3-shape#stackOrderAscending">d3.stackOrderAscending(series)</a> -  The series with the smallest sum with be placed on the bottom, ascending upwards to the largest.</p></li>

<li>

<p><a class="p_ident" id="p_p9IU4KWPFY" href="#p_p9IU4KWPFY" tabindex="-1" role="presentation"></a><a href="https://github.com/d3/d3-shape#stackOrderDescending">d3.stackOrderDescending(series)</a> - The series with the largest sum with be placed on the bottom, ascending upwards to the smallest.</p></li></ul>

<pre class="snippet cm-s-default" data-language="html" data-edit="editable" data-cm="hidden" ><a class="c_ident" id="c_Ft8Svmb6L0" href="#c_Ft8Svmb6L0" tabindex="-1" role="presentation"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>
        <span class="cm-keyword">var</span> <span class="cm-def">data</span> <span class="cm-operator">=</span> [
            {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">0</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">400</span>, <span class="cm-property">bananas</span>: <span class="cm-number">200</span>, <span class="cm-property">cherries</span>: <span class="cm-number">96</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">250</span>, <span class="cm-property">grapes</span>: <span class="cm-number">20</span>}},
            {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">160</span>, <span class="cm-property">bananas</span>: <span class="cm-number">150</span>, <span class="cm-property">cherries</span>: <span class="cm-number">96</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">200</span>, <span class="cm-property">grapes</span>: <span class="cm-number">25</span>}},
            {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">2</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>:  <span class="cm-number">64</span>, <span class="cm-property">bananas</span>:  <span class="cm-number">96</span>, <span class="cm-property">cherries</span>: <span class="cm-number">64</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">150</span>, <span class="cm-property">grapes</span>: <span class="cm-number">30</span>}},
            {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">3</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>:  <span class="cm-number">32</span>, <span class="cm-property">bananas</span>:  <span class="cm-number">48</span>, <span class="cm-property">cherries</span>: <span class="cm-number">64</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">100</span>, <span class="cm-property">grapes</span>: <span class="cm-number">20</span>}},
            {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">4</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>:  <span class="cm-number">40</span>, <span class="cm-property">bananas</span>: <span class="cm-number">100</span>, <span class="cm-property">cherries</span>: <span class="cm-number">64</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">115</span>, <span class="cm-property">grapes</span>: <span class="cm-number">45</span>}},
            {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">5</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">100</span>, <span class="cm-property">bananas</span>: <span class="cm-number">250</span>, <span class="cm-property">cherries</span>: <span class="cm-number">86</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">225</span>, <span class="cm-property">grapes</span>: <span class="cm-number">50</span>}},
            {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">6</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">100</span>, <span class="cm-property">bananas</span>: <span class="cm-number">125</span>, <span class="cm-property">cherries</span>: <span class="cm-number">96</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">200</span>, <span class="cm-property">grapes</span>: <span class="cm-number">15</span>}},
            {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">7</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">100</span>, <span class="cm-property">bananas</span>:  <span class="cm-number">75</span>, <span class="cm-property">cherries</span>: <span class="cm-number">106</span>, <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">210</span>, <span class="cm-property">grapes</span>: <span class="cm-number">10</span>}}
        ];
       
        <span class="cm-keyword">var</span> <span class="cm-def">xScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleTime</span>().<span class="cm-property">domain</span>([<span class="cm-variable">data</span>[<span class="cm-number">0</span>].<span class="cm-property">month</span>,<span class="cm-variable">data</span>[<span class="cm-variable">data</span>.<span class="cm-property">length</span> <span class="cm-operator">-</span><span class="cm-number">1</span>].<span class="cm-property">month</span>]).<span class="cm-property">range</span>([<span class="cm-number">50</span>,<span class="cm-number">275</span>]);
        <span class="cm-keyword">var</span> <span class="cm-def">yScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleLinear</span>().<span class="cm-property">domain</span>([<span class="cm-number">0</span>,<span class="cm-number">1000</span>]).<span class="cm-property">range</span>([<span class="cm-number">275</span>,<span class="cm-number">25</span>]);
        <span class="cm-keyword">var</span> <span class="cm-def">colorScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleOrdinal</span>()
            .<span class="cm-property">domain</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;cherries&quot;</span>, <span class="cm-string">&quot;dates&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>, <span class="cm-string">&quot;grapes&quot;</span>])
            .<span class="cm-property">range</span>([<span class="cm-string">&quot;red&quot;</span>, <span class="cm-string">&quot;yellow&quot;</span>, <span class="cm-string">&quot;pink&quot;</span>, <span class="cm-string">&quot;brown&quot;</span>, <span class="cm-string">&quot;orange&quot;</span>, <span class="cm-string">&quot;purple&quot;</span>]);
            
        <span class="cm-keyword">var</span> <span class="cm-def">stack1</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">stack</span>()
                .<span class="cm-property">keys</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;cherries&quot;</span>, <span class="cm-string">&quot;dates&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>, <span class="cm-string">&quot;grapes&quot;</span>])
                .<span class="cm-property">value</span>((<span class="cm-def">d</span>, <span class="cm-def">key</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">d</span>.<span class="cm-property">fruitSales</span>[<span class="cm-variable-2">key</span>])
                .<span class="cm-property">order</span>(<span class="cm-variable">d3</span>.<span class="cm-property">stackOrderAscending</span>)
                .<span class="cm-property">offset</span>(<span class="cm-variable">d3</span>.<span class="cm-property">stackOffsetNone</span>);
        <span class="cm-keyword">var</span> <span class="cm-def">stackedSeries1</span> <span class="cm-operator">=</span> <span class="cm-variable">stack1</span>(<span class="cm-variable">data</span>);

        <span class="cm-keyword">var</span> <span class="cm-def">stack2</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">stack</span>()
                .<span class="cm-property">keys</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;cherries&quot;</span>, <span class="cm-string">&quot;dates&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>, <span class="cm-string">&quot;grapes&quot;</span>])
                .<span class="cm-property">value</span>((<span class="cm-def">d</span>, <span class="cm-def">key</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">d</span>.<span class="cm-property">fruitSales</span>[<span class="cm-variable-2">key</span>])
                .<span class="cm-property">order</span>(<span class="cm-variable">d3</span>.<span class="cm-property">stackOrderDescending</span>)
                .<span class="cm-property">offset</span>(<span class="cm-variable">d3</span>.<span class="cm-property">stackOffsetNone</span>);
        <span class="cm-keyword">var</span> <span class="cm-def">stackedSeries2</span> <span class="cm-operator">=</span> <span class="cm-variable">stack2</span>(<span class="cm-variable">data</span>);

        <span class="cm-keyword">var</span> <span class="cm-def">area</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">area</span>()
            .<span class="cm-property">x</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">xScale</span>(<span class="cm-variable-2">d</span>.<span class="cm-property">data</span>.<span class="cm-property">month</span>))
            .<span class="cm-property">y0</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScale</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">0</span>]))
            .<span class="cm-property">y1</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScale</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">1</span>]))
            .<span class="cm-property">curve</span>(<span class="cm-variable">d3</span>.<span class="cm-property">curveBasis</span>);
        
        <span class="cm-variable">addAreas</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo5a&quot;</span>), <span class="cm-variable">stackedSeries1</span>, <span class="cm-variable">area</span>); <span class="cm-comment">// Areas to stackOrderAscending</span>
        <span class="cm-variable">addAreas</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo5d&quot;</span>), <span class="cm-variable">stackedSeries2</span>, <span class="cm-variable">area</span>); <span class="cm-comment">// Areas to stackOrderDescending </span>
        
        <span class="cm-variable">addLabels</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo5a&quot;</span>), <span class="cm-variable">stackedSeries1</span>, <span class="cm-variable">area</span>); <span class="cm-comment">// Add Labels to stackOrderAcsending</span>
        <span class="cm-variable">addLabels</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo5d&quot;</span>), <span class="cm-variable">stackedSeries2</span>, <span class="cm-variable">area</span>); <span class="cm-comment">// Add Labels to stackOrderDescending</span>
   <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>

   <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">svg</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;demo5a&quot;</span> <span class="cm-attribute">width</span>=<span class="cm-string">&quot;300&quot;</span> <span class="cm-attribute">height</span>=<span class="cm-string">&quot;300&quot;</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">svg</span><span class="cm-tag cm-bracket">&gt;</span>
   <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">svg</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;demo5d&quot;</span> <span class="cm-attribute">width</span>=<span class="cm-string">&quot;300&quot;</span> <span class="cm-attribute">height</span>=<span class="cm-string">&quot;300&quot;</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">svg</span><span class="cm-tag cm-bracket">&gt;</span></pre><figure class="sandbox"><figcaption>Figure 6. Stacks using d3.stackOrderAscending (left) and d3.stackOrderDescending (right). </figcaption></figure>


<h3><a class="i_ident" id="i_MXZxoXRzRD" href="#i_MXZxoXRzRD" tabindex="-1" role="presentation"></a>Ordering based on the maximum value of each series</h3>

<p><a class="p_ident" id="p_R0UtdMiwcV" href="#p_R0UtdMiwcV" tabindex="-1" role="presentation"></a>When creating stacks to visualize large amounts of data, readability is important. <code>d3.<wbr>stackOrderAppearance</code> and <code>d3.<wbr>stackOrderInsideOut</code> can be used to improve readability of a stack visualization by ordering the series based on the maximum value of each series or more specifically, the index of the maximum value for each series.</p>

<p><a class="p_ident" id="p_zl5sPvIqbF" href="#p_zl5sPvIqbF" tabindex="-1" role="presentation"></a>Take for example the dataset shown below containing sales data for 4 fruits over 14 months.  When <code>d3.<wbr>stackOrderAppearance</code> and <code>d3.<wbr>stackOrderInsideOut</code> order the fruit series, they find the index of the maximum value for each series.  We’ve highlighted these indices and values in the table below.</p><style>
  table {
    border-collapse:collapse;
    border-spacing:0;
    border-color:#9ABAD9;
    margin:0 auto;
  }
  th, td{
    font-family:Arial,sans-serif;
    font-size:14px;
    font-weight:normal;
    padding:1px 20px;
    border-style:solid;
    border-width:1px;
    overflow:hidden;
    word-break:normal;
    border-color:#9ABAD9;
    text-align:center;
    vertical-align:top;
    background-color:#EBF5FF;
    color:dimgray;
  }
  .blue {background-color:blue;color:lightgray;}
  .red  {background-color:red;color:lightgray;}
  .yellow {background-color:yellow;}
  .orange {background-color:orange;}
  .purple  {background-color:purple;color:lightgray;}

</style>
<table>
  <tr>
    <th class="blue">Index</th>
    <th class="red">Apples</th>
    <th class ="yellow">Bananas</th>
    <th class="orange">Oranges</th>
    <th class="purple">Grapes</th>
  </tr>
<tr><td>0</td><td>1</td><td>1</td><td>1</td><td>1</td></tr>
<tr><td>1</td><td>10</td><td>1</td><td>1</td><td>1</td></tr>
<tr><td class="red">2</td><td class="red">25</td><td>1</td><td>1</td><td>1</td></tr>
<tr><td>3</td><td>10</td><td>1</td><td>1</td><td>1</td></tr>
<tr><td>4</td><td>1</td><td>1</td><td>1</td><td>10</td></tr>
<tr><td class="purple">5</td><td>1</td><td>1</td><td>1</td><td class="purple">25</td></tr>
<tr><td>6</td><td>1</td><td>1</td><td>1</td><td>10</td></tr>
<tr><td>7</td><td>1</td><td>1</td><td>10</td><td>1</td></tr>
<tr><td class="orange">8</td><td>1</td><td>1</td><td class="orange">25</td><td>1</td></tr>
<tr><td>9</td><td>1</td><td>1</td><td>10</td><td>1</td></tr>
<tr><td>10</td><td>1</td><td>10</td><td>1</td><td>1</td></tr>
<tr><td class="yellow">11</td><td>1</td><td class="yellow">25</td><td>1</td><td>1</td></tr>
<tr><td>12</td><td>1</td><td>10</td><td>1</td><td>1</td></tr>
<tr><td>13</td><td>1</td><td>1</td><td>1</td><td>1</td></tr>
<tr>
  <td>Index at <br>Max Value</td>
  <td class="red">Apples: 2</td>
  <td class="yellow">Bananas: 11</td>
  <td class="orange">Oranges: 8</td>
  <td class="purple">Grapes: 5</td>
</tr>
</table>


<p><a class="p_ident" id="p_CvYmlqZohc" href="#p_CvYmlqZohc" tabindex="-1" role="presentation"></a>Next, the orderings create an array containing the <em>indices</em> of the maximum values.</p><table>
  <tr>
    <th></th>
    <th class="red">Apples</th>
    <th class="yellow">Bananas</th>
    <th class="orange">Oranges</th>
    <th class="purple">Grapes</th>
  </tr>
  <tr>
    <td>Indices</td>
    <td>2</td>
    <td>11</td>
    <td>8</td>
    <td>5</td>
  </tr>
</table>
<br>


<p><a class="p_ident" id="p_c0OJtzvGPL" href="#p_c0OJtzvGPL" tabindex="-1" role="presentation"></a>Finally, the series are sorted according to the indices of their maximum values.</p>

<ul>

<li>

<p><a class="p_ident" id="p_h1DDix7Ec9" href="#p_h1DDix7Ec9" tabindex="-1" role="presentation"></a><a href="https://github.com/d3/d3-shape#stackOrderAppearance">d3.stackOrderAppearance(series)</a> - orders the series such that the series having the earliest maximum value (i.e. series with its maximum value at the lowest index) is positioned at the bottom of the stack, and the series having the latest maximum is placed on the top.</p></li></ul>

<p><a class="p_ident" id="p_ojK3YkoeU1" href="#p_ojK3YkoeU1" tabindex="-1" role="presentation"></a>Here we see that the series are sorted in the following order: apples, grapes, oranges, and bananas.</p><table>
  <tr>
    <th></th>
    <th class="red">Apples</th>
    <th class="purple">Grapes</th>
    <th class="orange">Oranges</th>
    <th class="yellow">Bananas</th>
  </tr>
  <tr>
    <td>Indices</td>
    <td>2</td>
    <td>5</td>
    <td>8</td>
    <td>11</td>
  </tr>
    <tr>
    <td></td>
    <td colspan="4">-------------------------------------------------------&gt;</td>
  </tr>
</table>


<pre class="snippet cm-s-default" data-language="html" data-edit="editable" data-cm="hidden" ><a class="c_ident" id="c_NHVG4MJuWb" href="#c_NHVG4MJuWb" tabindex="-1" role="presentation"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>
    <span class="cm-keyword">var</span> <span class="cm-def">data</span> <span class="cm-operator">=</span> [
   		{<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">0</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">1</span>,    <span class="cm-property">bananas</span>: <span class="cm-number">1</span>,   <span class="cm-property">oranges</span>: <span class="cm-number">1</span>,   <span class="cm-property">grapes</span>: <span class="cm-number">1</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">10</span>,   <span class="cm-property">bananas</span>: <span class="cm-number">1</span>,   <span class="cm-property">oranges</span>: <span class="cm-number">1</span>,   <span class="cm-property">grapes</span>: <span class="cm-number">1</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">2</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">25</span>,   <span class="cm-property">bananas</span>: <span class="cm-number">1</span>,   <span class="cm-property">oranges</span>: <span class="cm-number">1</span>,   <span class="cm-property">grapes</span>: <span class="cm-number">1</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">3</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">10</span>,   <span class="cm-property">bananas</span>: <span class="cm-number">1</span>,   <span class="cm-property">oranges</span>: <span class="cm-number">1</span>,   <span class="cm-property">grapes</span>: <span class="cm-number">1</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">4</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">1</span>,    <span class="cm-property">bananas</span>: <span class="cm-number">1</span>,  <span class="cm-property">oranges</span>: <span class="cm-number">1</span>,   <span class="cm-property">grapes</span>: <span class="cm-number">10</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">5</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">1</span>,    <span class="cm-property">bananas</span>: <span class="cm-number">1</span>,  <span class="cm-property">oranges</span>: <span class="cm-number">1</span>,   <span class="cm-property">grapes</span>: <span class="cm-number">25</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">6</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">1</span>,    <span class="cm-property">bananas</span>: <span class="cm-number">1</span>,  <span class="cm-property">oranges</span>: <span class="cm-number">1</span>,   <span class="cm-property">grapes</span>: <span class="cm-number">10</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">7</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">1</span>,    <span class="cm-property">bananas</span>: <span class="cm-number">1</span>,   <span class="cm-property">oranges</span>: <span class="cm-number">10</span>,  <span class="cm-property">grapes</span>: <span class="cm-number">1</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">8</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">1</span>,    <span class="cm-property">bananas</span>: <span class="cm-number">1</span>,   <span class="cm-property">oranges</span>: <span class="cm-number">25</span>,  <span class="cm-property">grapes</span>: <span class="cm-number">1</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">9</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">1</span>,    <span class="cm-property">bananas</span>: <span class="cm-number">1</span>,   <span class="cm-property">oranges</span>: <span class="cm-number">10</span>,  <span class="cm-property">grapes</span>: <span class="cm-number">1</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">10</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">1</span>,    <span class="cm-property">bananas</span>: <span class="cm-number">10</span>,   <span class="cm-property">oranges</span>: <span class="cm-number">1</span>,   <span class="cm-property">grapes</span>: <span class="cm-number">1</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">11</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">1</span>,    <span class="cm-property">bananas</span>: <span class="cm-number">25</span>,   <span class="cm-property">oranges</span>: <span class="cm-number">1</span>,   <span class="cm-property">grapes</span>: <span class="cm-number">1</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2019</span>, <span class="cm-number">0</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">1</span>,    <span class="cm-property">bananas</span>: <span class="cm-number">10</span>,   <span class="cm-property">oranges</span>: <span class="cm-number">1</span>,   <span class="cm-property">grapes</span>: <span class="cm-number">1</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2019</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">1</span>,    <span class="cm-property">bananas</span>: <span class="cm-number">1</span>,   <span class="cm-property">oranges</span>: <span class="cm-number">1</span>,   <span class="cm-property">grapes</span>: <span class="cm-number">1</span>}}
    ];

    <span class="cm-keyword">var</span> <span class="cm-def">xScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleLinear</span>().<span class="cm-property">domain</span>([<span class="cm-variable">data</span>[<span class="cm-number">0</span>].<span class="cm-property">month</span>, <span class="cm-variable">data</span>[<span class="cm-variable">data</span>.<span class="cm-property">length</span><span class="cm-operator">-</span><span class="cm-number">1</span>].<span class="cm-property">month</span>]).<span class="cm-property">range</span>([<span class="cm-number">10</span>,<span class="cm-number">290</span>]);
    <span class="cm-keyword">var</span> <span class="cm-def">yScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleLinear</span>().<span class="cm-property">domain</span>([<span class="cm-number">0</span>,<span class="cm-number">30</span>]).<span class="cm-property">range</span>([<span class="cm-number">175</span>,<span class="cm-number">25</span>]);
    <span class="cm-keyword">var</span> <span class="cm-def">colorScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleOrdinal</span>()
        .<span class="cm-property">domain</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>, <span class="cm-string">&quot;grapes&quot;</span>])
        .<span class="cm-property">range</span>([<span class="cm-string">&quot;red&quot;</span>, <span class="cm-string">&quot;yellow&quot;</span>, <span class="cm-string">&quot;orange&quot;</span>, <span class="cm-string">&quot;purple&quot;</span>]);

    <span class="cm-keyword">var</span> <span class="cm-def">stack1</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">stack</span>()
            .<span class="cm-property">keys</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>, <span class="cm-string">&quot;grapes&quot;</span>])
            .<span class="cm-property">value</span>((<span class="cm-def">d</span>, <span class="cm-def">key</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">d</span>.<span class="cm-property">fruitSales</span>[<span class="cm-variable-2">key</span>]);
            
    <span class="cm-keyword">var</span> <span class="cm-def">stackedSeries1</span> <span class="cm-operator">=</span> <span class="cm-variable">stack1</span>(<span class="cm-variable">data</span>);

    <span class="cm-keyword">var</span> <span class="cm-def">stack2</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">stack</span>()
            .<span class="cm-property">keys</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>, <span class="cm-string">&quot;grapes&quot;</span>])
            .<span class="cm-property">value</span>((<span class="cm-def">d</span>, <span class="cm-def">key</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">d</span>.<span class="cm-property">fruitSales</span>[<span class="cm-variable-2">key</span>])
            .<span class="cm-property">order</span>(<span class="cm-variable">d3</span>.<span class="cm-property">stackOrderAppearance</span>);
            
    <span class="cm-keyword">var</span> <span class="cm-def">stackedSeries2</span> <span class="cm-operator">=</span> <span class="cm-variable">stack2</span>(<span class="cm-variable">data</span>);

    <span class="cm-keyword">var</span> <span class="cm-def">area</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">area</span>()
        .<span class="cm-property">x</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">xScale</span>(<span class="cm-variable-2">d</span>.<span class="cm-property">data</span>.<span class="cm-property">month</span>))
        .<span class="cm-property">y0</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScale</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">0</span>]))
        .<span class="cm-property">y1</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScale</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">1</span>]))
        .<span class="cm-property">curve</span>(<span class="cm-variable">d3</span>.<span class="cm-property">curveBasis</span>);

    <span class="cm-variable">addAreas</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo6&quot;</span>), <span class="cm-variable">stackedSeries1</span>, <span class="cm-variable">area</span>);  <span class="cm-comment">// Areas to default order</span>
    <span class="cm-variable">addAreas</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo6a&quot;</span>), <span class="cm-variable">stackedSeries2</span>, <span class="cm-variable">area</span>); <span class="cm-comment">// Areas to stackOrderAppearance</span>
        
    <span class="cm-variable">addLabels</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo6&quot;</span>), <span class="cm-variable">stackedSeries1</span>, <span class="cm-variable">area</span>); <span class="cm-comment">// Labels to default order</span>
    <span class="cm-variable">addLabels</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo6a&quot;</span>), <span class="cm-variable">stackedSeries2</span>, <span class="cm-variable">area</span>); <span class="cm-comment">// Labels to stackOrderAppearance</span>
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>

<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">svg</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;demo6&quot;</span> <span class="cm-attribute">class</span>=<span class="cm-string">&quot;svgClass&quot;</span> <span class="cm-attribute">width</span>=<span class="cm-string">&quot;300&quot;</span> <span class="cm-attribute">height</span>=<span class="cm-string">&quot;200&quot;</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">svg</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">svg</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;demo6a&quot;</span> <span class="cm-attribute">class</span>=<span class="cm-string">&quot;svgClass&quot;</span> <span class="cm-attribute">width</span>=<span class="cm-string">&quot;300&quot;</span> <span class="cm-attribute">height</span>=<span class="cm-string">&quot;200&quot;</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">svg</span><span class="cm-tag cm-bracket">&gt;</span></pre><figure class="sandbox"><figcaption>Figure 7. Stacks using the default order (left) and d3.stackOrderAppearance (right). </figcaption></figure>


<ul>

<li>

<p><a class="p_ident" id="p_ztkxYWYkTt" href="#p_ztkxYWYkTt" tabindex="-1" role="presentation"></a><a href="https://github.com/d3/d3-shape#stackOrderInsideOut">d3.stackOrderInsideOut(series)</a> - orders the series, from the inside out, with the series having the earliest maximum value (i.e. series with its maximum value at the lowest index) positioned in the middle, and the series having the latest maximum value positioned on the outside.</p></li></ul>

<p><a class="p_ident" id="p_Np6LXeyiFC" href="#p_Np6LXeyiFC" tabindex="-1" role="presentation"></a>Here we see that the series are sorted in the following order: oranges, apples, grapes, and bananas.</p><table>
  <tr>
    <th></th>
<th class="orange">Oranges</th>
    <th class="red">Apples</th>
    <th class="purple">Grapes</th>
    <th class="yellow">Bananas</th>
  </tr>
  <tr>
    <td>Indices</td>
    <td>8</td>
    <td>2</td>
    <td>5</td>
    <td>11</td>
  </tr>
    <tr>
    <td></td>
    <td colspan="4">&lt;-------------------------- --------------------------&gt;</td>
  </tr>
</table>


<pre class="snippet cm-s-default" data-language="html" data-edit="editable" data-cm="hidden" ><a class="c_ident" id="c_fMbcEBax7/" href="#c_fMbcEBax7/" tabindex="-1" role="presentation"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>
    <span class="cm-keyword">var</span> <span class="cm-def">data</span> <span class="cm-operator">=</span> [
   		{<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">0</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">1</span>,    <span class="cm-property">bananas</span>: <span class="cm-number">1</span>,   <span class="cm-property">oranges</span>: <span class="cm-number">1</span>,   <span class="cm-property">grapes</span>: <span class="cm-number">1</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">10</span>,   <span class="cm-property">bananas</span>: <span class="cm-number">1</span>,   <span class="cm-property">oranges</span>: <span class="cm-number">1</span>,   <span class="cm-property">grapes</span>: <span class="cm-number">1</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">2</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">25</span>,   <span class="cm-property">bananas</span>: <span class="cm-number">1</span>,   <span class="cm-property">oranges</span>: <span class="cm-number">1</span>,   <span class="cm-property">grapes</span>: <span class="cm-number">1</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">3</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">10</span>,   <span class="cm-property">bananas</span>: <span class="cm-number">1</span>,   <span class="cm-property">oranges</span>: <span class="cm-number">1</span>,   <span class="cm-property">grapes</span>: <span class="cm-number">1</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">4</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">1</span>,    <span class="cm-property">bananas</span>: <span class="cm-number">1</span>,  <span class="cm-property">oranges</span>: <span class="cm-number">1</span>,   <span class="cm-property">grapes</span>: <span class="cm-number">10</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">5</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">1</span>,    <span class="cm-property">bananas</span>: <span class="cm-number">1</span>,  <span class="cm-property">oranges</span>: <span class="cm-number">1</span>,   <span class="cm-property">grapes</span>: <span class="cm-number">25</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">6</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">1</span>,    <span class="cm-property">bananas</span>: <span class="cm-number">1</span>,  <span class="cm-property">oranges</span>: <span class="cm-number">1</span>,   <span class="cm-property">grapes</span>: <span class="cm-number">10</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">7</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">1</span>,    <span class="cm-property">bananas</span>: <span class="cm-number">1</span>,   <span class="cm-property">oranges</span>: <span class="cm-number">10</span>,  <span class="cm-property">grapes</span>: <span class="cm-number">1</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">8</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">1</span>,    <span class="cm-property">bananas</span>: <span class="cm-number">1</span>,   <span class="cm-property">oranges</span>: <span class="cm-number">25</span>,  <span class="cm-property">grapes</span>: <span class="cm-number">1</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">9</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">1</span>,    <span class="cm-property">bananas</span>: <span class="cm-number">1</span>,   <span class="cm-property">oranges</span>: <span class="cm-number">10</span>,  <span class="cm-property">grapes</span>: <span class="cm-number">1</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">10</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">1</span>,    <span class="cm-property">bananas</span>: <span class="cm-number">10</span>,   <span class="cm-property">oranges</span>: <span class="cm-number">1</span>,   <span class="cm-property">grapes</span>: <span class="cm-number">1</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">11</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">1</span>,    <span class="cm-property">bananas</span>: <span class="cm-number">25</span>,   <span class="cm-property">oranges</span>: <span class="cm-number">1</span>,   <span class="cm-property">grapes</span>: <span class="cm-number">1</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2019</span>, <span class="cm-number">0</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">1</span>,    <span class="cm-property">bananas</span>: <span class="cm-number">10</span>,   <span class="cm-property">oranges</span>: <span class="cm-number">1</span>,   <span class="cm-property">grapes</span>: <span class="cm-number">1</span>}},
        {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2019</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span>),  <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">1</span>,    <span class="cm-property">bananas</span>: <span class="cm-number">1</span>,   <span class="cm-property">oranges</span>: <span class="cm-number">1</span>,   <span class="cm-property">grapes</span>: <span class="cm-number">1</span>}}
    ];

    <span class="cm-keyword">var</span> <span class="cm-def">xScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleLinear</span>().<span class="cm-property">domain</span>([<span class="cm-variable">data</span>[<span class="cm-number">0</span>].<span class="cm-property">month</span>, <span class="cm-variable">data</span>[<span class="cm-variable">data</span>.<span class="cm-property">length</span><span class="cm-operator">-</span><span class="cm-number">1</span>].<span class="cm-property">month</span>]).<span class="cm-property">range</span>([<span class="cm-number">10</span>,<span class="cm-number">290</span>]);
    <span class="cm-keyword">var</span> <span class="cm-def">yScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleLinear</span>().<span class="cm-property">domain</span>([<span class="cm-number">0</span>,<span class="cm-number">30</span>]).<span class="cm-property">range</span>([<span class="cm-number">175</span>,<span class="cm-number">25</span>]);
    <span class="cm-keyword">var</span> <span class="cm-def">colorScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleOrdinal</span>()
        .<span class="cm-property">domain</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>, <span class="cm-string">&quot;grapes&quot;</span>])
        .<span class="cm-property">range</span>([<span class="cm-string">&quot;red&quot;</span>, <span class="cm-string">&quot;yellow&quot;</span>, <span class="cm-string">&quot;orange&quot;</span>, <span class="cm-string">&quot;purple&quot;</span>]);

    <span class="cm-keyword">var</span> <span class="cm-def">stack1</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">stack</span>()
            .<span class="cm-property">keys</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>, <span class="cm-string">&quot;grapes&quot;</span>])
            .<span class="cm-property">value</span>((<span class="cm-def">d</span>, <span class="cm-def">key</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">d</span>.<span class="cm-property">fruitSales</span>[<span class="cm-variable-2">key</span>]);
            
    <span class="cm-keyword">var</span> <span class="cm-def">stackedSeries1</span> <span class="cm-operator">=</span> <span class="cm-variable">stack1</span>(<span class="cm-variable">data</span>);

    <span class="cm-keyword">var</span> <span class="cm-def">stack2</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">stack</span>()
            .<span class="cm-property">keys</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>, <span class="cm-string">&quot;grapes&quot;</span>])
            .<span class="cm-property">value</span>((<span class="cm-def">d</span>, <span class="cm-def">key</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">d</span>.<span class="cm-property">fruitSales</span>[<span class="cm-variable-2">key</span>])
            .<span class="cm-property">order</span>(<span class="cm-variable">d3</span>.<span class="cm-property">stackOrderInsideOut</span>)
            .<span class="cm-property">offset</span>(<span class="cm-variable">d3</span>.<span class="cm-property">stackOffsetWiggle</span>);
            
    <span class="cm-keyword">var</span> <span class="cm-def">stackedSeries2</span> <span class="cm-operator">=</span> <span class="cm-variable">stack2</span>(<span class="cm-variable">data</span>);

    <span class="cm-keyword">var</span> <span class="cm-def">area1</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">area</span>()
        .<span class="cm-property">x</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">xScale</span>(<span class="cm-variable-2">d</span>.<span class="cm-property">data</span>.<span class="cm-property">month</span>))
        .<span class="cm-property">y0</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScale</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">0</span>]))
        .<span class="cm-property">y1</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScale</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">1</span>]))
        .<span class="cm-property">curve</span>(<span class="cm-variable">d3</span>.<span class="cm-property">curveBasis</span>);
        
    <span class="cm-keyword">var</span> <span class="cm-def">area2</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">area</span>()
        .<span class="cm-property">x</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">xScale</span>(<span class="cm-variable-2">d</span>.<span class="cm-property">data</span>.<span class="cm-property">month</span>))
        .<span class="cm-property">y0</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScale</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">0</span>] <span class="cm-operator">+</span> <span class="cm-number">25</span><span class="cm-operator">/</span><span class="cm-number">2</span>))
        .<span class="cm-property">y1</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScale</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">1</span>] <span class="cm-operator">+</span> <span class="cm-number">25</span><span class="cm-operator">/</span><span class="cm-number">2</span>))
        .<span class="cm-property">curve</span>(<span class="cm-variable">d3</span>.<span class="cm-property">curveBasis</span>);

    <span class="cm-variable">addAreas</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo6b&quot;</span>), <span class="cm-variable">stackedSeries1</span>, <span class="cm-variable">area1</span>); <span class="cm-comment">// Areas to stackOrderAppearance</span>
    <span class="cm-variable">addAreas</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo6i&quot;</span>), <span class="cm-variable">stackedSeries2</span>, <span class="cm-variable">area2</span>); <span class="cm-comment">// Areas to stackOrderInsideOut</span>
        
    <span class="cm-variable">addLabels</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo6b&quot;</span>), <span class="cm-variable">stackedSeries1</span>, <span class="cm-variable">area1</span>); <span class="cm-comment">// Labels to stackOrderAppearance</span>
    <span class="cm-variable">addLabels</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo6i&quot;</span>), <span class="cm-variable">stackedSeries2</span>, <span class="cm-variable">area2</span>); <span class="cm-comment">// Labels to stackOrderInsideOut</span>
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>

<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">svg</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;demo6b&quot;</span> <span class="cm-attribute">class</span>=<span class="cm-string">&quot;svgClass&quot;</span> <span class="cm-attribute">width</span>=<span class="cm-string">&quot;300&quot;</span> <span class="cm-attribute">height</span>=<span class="cm-string">&quot;200&quot;</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">svg</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">svg</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;demo6i&quot;</span> <span class="cm-attribute">class</span>=<span class="cm-string">&quot;svgClass&quot;</span> <span class="cm-attribute">width</span>=<span class="cm-string">&quot;300&quot;</span> <span class="cm-attribute">height</span>=<span class="cm-string">&quot;200&quot;</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">svg</span><span class="cm-tag cm-bracket">&gt;</span></pre><figure class="sandbox"><figcaption>Figure 8. Stacks using the default order (left) and d3.stackOrderInsideOut (right). </figcaption></figure>


<p><a class="p_ident" id="p_LvK4O+cKvu" href="#p_LvK4O+cKvu" tabindex="-1" role="presentation"></a>Note that <code>d3.<wbr>stackOrderInsideOut</code> can be used to make streamgraphs as we do in Figure 8. When doing so we also set the <code>offset</code> to <code>d3.<wbr>stackOffsetWiggle</code>.  For more information, please see the section on stack offsets below.</p>

<p><a class="p_ident" id="p_HLteZoS6Zt" href="#p_HLteZoS6Zt" tabindex="-1" role="presentation"></a>For more information on the orderings used by <code>d3.<wbr>stackOrderAppearance</code> and <code>d3.<wbr>stackOrderInsideOut</code> please see <a href="http://leebyron.com/streamgraph/stackedgraphs_byron_wattenberg.pdf">Stacked Graphs—Geometry &amp; Aesthetics</a> by Byron &amp; Wattenberg.</p>

<h2><a class="h_ident" id="h_1BRsPfmoV7" href="#h_1BRsPfmoV7" tabindex="-1" role="presentation"></a>Stack Offsets</h2>

<p><a class="p_ident" id="p_h1UutSWt/9" href="#p_h1UutSWt/9" tabindex="-1" role="presentation"></a>The <em>baseline</em> of a stack is the line <em>y=0</em>.  By default, the series are positioned above the baseline with the first series’ lower y-coordinates set at the baseline.  Often, we’ll want to change how the series are positioned relative to the baseline.  For example, we may want positive data points positioned above the baseline and lower data points positioned below the baseline.</p>

<p><a class="p_ident" id="p_O9K+y4P9ZE" href="#p_O9K+y4P9ZE" tabindex="-1" role="presentation"></a>To change how the series are positioned relative to the baseline we call <code>stack.offset</code> and pass to it an offset function.</p>

<ul>

<li>

<p><a class="p_ident" id="p_6PtdB5VF/V" href="#p_6PtdB5VF/V" tabindex="-1" role="presentation"></a><a href="https://github.com/d3/d3-shape#stack_offset">stack.offset([offset])</a> - Takes an offset function as an argument and returns the stack generator.</p></li></ul>

<p><a class="p_ident" id="p_XEBirJWZLY" href="#p_XEBirJWZLY" tabindex="-1" role="presentation"></a>If the stack generator has an offset that is not the default, we can change it to the default using <code>d3.<wbr>stackOffsetNone</code>.</p>

<ul>

<li>

<p><a class="p_ident" id="p_7Q09e7QU1o" href="#p_7Q09e7QU1o" tabindex="-1" role="presentation"></a><a href="https://github.com/d3/d3-shape#stackOffsetNone">d3.stackOffsetNone(series, order)</a> - Applies a zero baseline.</p></li></ul>

<pre class="snippet cm-s-default" data-language="html" data-edit="editable" data-cm="hidden" ><a class="c_ident" id="c_S63nG+mfWG" href="#c_S63nG+mfWG" tabindex="-1" role="presentation"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-keyword">var</span> <span class="cm-def">data</span> <span class="cm-operator">=</span> [
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">0</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">400</span>, <span class="cm-property">bananas</span>: <span class="cm-number">200</span>, <span class="cm-property">cherries</span>: <span class="cm-number">96</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">250</span>, <span class="cm-property">grapes</span>: <span class="cm-number">20</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">160</span>, <span class="cm-property">bananas</span>: <span class="cm-number">150</span>, <span class="cm-property">cherries</span>: <span class="cm-number">96</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">200</span>, <span class="cm-property">grapes</span>: <span class="cm-number">25</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">2</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>:  <span class="cm-number">64</span>, <span class="cm-property">bananas</span>:  <span class="cm-number">96</span>, <span class="cm-property">cherries</span>: <span class="cm-number">64</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">150</span>, <span class="cm-property">grapes</span>: <span class="cm-number">30</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">3</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>:  <span class="cm-number">32</span>, <span class="cm-property">bananas</span>:  <span class="cm-number">48</span>, <span class="cm-property">cherries</span>: <span class="cm-number">64</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">100</span>, <span class="cm-property">grapes</span>: <span class="cm-number">20</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">4</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>:  <span class="cm-number">40</span>, <span class="cm-property">bananas</span>: <span class="cm-number">100</span>, <span class="cm-property">cherries</span>: <span class="cm-number">64</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">115</span>, <span class="cm-property">grapes</span>: <span class="cm-number">45</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">5</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">100</span>, <span class="cm-property">bananas</span>: <span class="cm-number">250</span>, <span class="cm-property">cherries</span>: <span class="cm-number">86</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">225</span>, <span class="cm-property">grapes</span>: <span class="cm-number">50</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">6</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">150</span>, <span class="cm-property">bananas</span>: <span class="cm-number">125</span>, <span class="cm-property">cherries</span>: <span class="cm-number">96</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">200</span>, <span class="cm-property">grapes</span>: <span class="cm-number">15</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">7</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">100</span>, <span class="cm-property">bananas</span>:  <span class="cm-number">75</span>, <span class="cm-property">cherries</span>: <span class="cm-number">106</span>, <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">210</span>, <span class="cm-property">grapes</span>: <span class="cm-number">10</span>}}
];

<span class="cm-keyword">var</span> <span class="cm-def">xScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleTime</span>().<span class="cm-property">domain</span>([<span class="cm-variable">data</span>[<span class="cm-number">0</span>].<span class="cm-property">month</span>, <span class="cm-variable">data</span>[<span class="cm-variable">data</span>.<span class="cm-property">length</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>].<span class="cm-property">month</span>]).<span class="cm-property">range</span>([<span class="cm-number">50</span>,<span class="cm-number">275</span>]);
<span class="cm-keyword">var</span> <span class="cm-def">yScaleNone</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleLinear</span>().<span class="cm-property">domain</span>([<span class="cm-number">0</span>,<span class="cm-number">1000</span>]).<span class="cm-property">range</span>([<span class="cm-number">275</span>,<span class="cm-number">25</span>]);
<span class="cm-keyword">var</span> <span class="cm-def">yScaleExpand</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleLinear</span>().<span class="cm-property">domain</span>([<span class="cm-number">0</span>,<span class="cm-number">1</span>]).<span class="cm-property">range</span>([<span class="cm-number">275</span>,<span class="cm-number">25</span>]);
<span class="cm-keyword">var</span> <span class="cm-def">colorScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleOrdinal</span>()
  .<span class="cm-property">domain</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;cherries&quot;</span>, <span class="cm-string">&quot;dates&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>, <span class="cm-string">&quot;grapes&quot;</span>])
  .<span class="cm-property">range</span>([<span class="cm-string">&quot;red&quot;</span>, <span class="cm-string">&quot;yellow&quot;</span>, <span class="cm-string">&quot;pink&quot;</span>, <span class="cm-string">&quot;brown&quot;</span>, <span class="cm-string">&quot;orange&quot;</span>, <span class="cm-string">&quot;purple&quot;</span>]);

<span class="cm-keyword">var</span> <span class="cm-def">stack</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">stack</span>() 
  .<span class="cm-property">keys</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;cherries&quot;</span>, <span class="cm-string">&quot;dates&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>, <span class="cm-string">&quot;grapes&quot;</span>])
  .<span class="cm-property">value</span>((<span class="cm-def">d</span>, <span class="cm-def">key</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">d</span>.<span class="cm-property">fruitSales</span>[<span class="cm-variable-2">key</span>])
  .<span class="cm-property">order</span>(<span class="cm-variable">d3</span>.<span class="cm-property">stackOrderNone</span>)
  .<span class="cm-property">offset</span>(<span class="cm-variable">d3</span>.<span class="cm-property">stackOffsetNone</span>);
        
<span class="cm-keyword">var</span> <span class="cm-def">stackedSeries</span> <span class="cm-operator">=</span> <span class="cm-variable">stack</span>(<span class="cm-variable">data</span>);

<span class="cm-keyword">var</span> <span class="cm-def">areaNone</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">area</span>()
  .<span class="cm-property">x</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">xScale</span>(<span class="cm-variable-2">d</span>.<span class="cm-property">data</span>.<span class="cm-property">month</span>))
  .<span class="cm-property">y0</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScaleNone</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">0</span>]))
  .<span class="cm-property">y1</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScaleNone</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">1</span>]))
  .<span class="cm-property">curve</span>(<span class="cm-variable">d3</span>.<span class="cm-property">curveBasis</span>);

<span class="cm-variable">addAreas</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo7&quot;</span>).<span class="cm-property">select</span>(<span class="cm-string">&quot;#stack&quot;</span>), <span class="cm-variable">stackedSeries</span>, <span class="cm-variable">areaNone</span>);
<span class="cm-variable">addLabels</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo7&quot;</span>).<span class="cm-property">select</span>(<span class="cm-string">&quot;#stack&quot;</span>), <span class="cm-variable">stackedSeries</span>, <span class="cm-variable">areaNone</span>);
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>

<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">svg</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;demo7&quot;</span> <span class="cm-attribute">width</span>=<span class="cm-string">&quot;300&quot;</span> <span class="cm-attribute">height</span>=<span class="cm-string">&quot;300&quot;</span><span class="cm-tag cm-bracket">&gt;</span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">g</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;stack&quot;</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">g</span><span class="cm-tag cm-bracket">&gt;</span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">g</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;baseline&quot;</span><span class="cm-tag cm-bracket">&gt;</span>
      <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">text</span> <span class="cm-attribute">y</span>=<span class="cm-string">&quot;290&quot;</span><span class="cm-tag cm-bracket">&gt;</span>Baseline<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">text</span><span class="cm-tag cm-bracket">&gt;</span>
      <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">path</span> <span class="cm-attribute">d</span>=<span class="cm-string">&quot;M 25 275 l 325 0&quot;</span> <span class="cm-attribute">stroke</span>=<span class="cm-string">&quot;black&quot;</span> <span class="cm-attribute">stroke-dasharray</span>=<span class="cm-string">&quot;10,5&quot;</span> <span class="cm-attribute">stroke-width</span>=<span class="cm-string">&quot;2px&quot;</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">path</span><span class="cm-tag cm-bracket">&gt;</span>
  <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">g</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">svg</span><span class="cm-tag cm-bracket">&gt;</span></pre><figure class="sandbox"><figcaption>Figure 9. Stack with the default offset. </figcaption></figure>


<p><a class="p_ident" id="p_moRJb2y+df" href="#p_moRJb2y+df" tabindex="-1" role="presentation"></a>If we wish to position all positive data points above the baseline and negative data points below the baseline we can use <code>d3.<wbr>stackOffsetDiverging</code>.</p>

<ul>

<li>

<p><a class="p_ident" id="p_fSW97x2Y0I" href="#p_fSW97x2Y0I" tabindex="-1" role="presentation"></a><a id="diverging"></a><a href="https://github.com/d3/d3-shape#stackOffsetDiverging">d3.stackOffsetDiverging(series, order)</a> - Has positive values above 0, and negative values below 0. Best used with SVG rect elements instead of areas.</p></li></ul>

<pre class="snippet cm-s-default" data-language="html" data-edit="editable" data-cm="hidden" ><a class="c_ident" id="c_b3qFU9E40n" href="#c_b3qFU9E40n" tabindex="-1" role="presentation"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-keyword">var</span> <span class="cm-def">data</span> <span class="cm-operator">=</span> [
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">0</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">400</span>, <span class="cm-property">bananas</span>: <span class="cm-number">200</span>, <span class="cm-property">cherries</span>: <span class="cm-number">96</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">250</span>, <span class="cm-property">grapes</span>: <span class="cm-number">20</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">160</span>, <span class="cm-property">bananas</span>: <span class="cm-number">150</span>, <span class="cm-property">cherries</span>: <span class="cm-number">96</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">200</span>, <span class="cm-property">grapes</span>: <span class="cm-number">25</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">2</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>:  <span class="cm-number">64</span>, <span class="cm-property">bananas</span>:  <span class="cm-number">96</span>, <span class="cm-property">cherries</span>: <span class="cm-number">64</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">150</span>, <span class="cm-property">grapes</span>: <span class="cm-operator">-</span><span class="cm-number">30</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">3</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>:  <span class="cm-number">32</span>, <span class="cm-property">bananas</span>:  <span class="cm-number">48</span>, <span class="cm-property">cherries</span>: <span class="cm-number">64</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">100</span>, <span class="cm-property">grapes</span>: <span class="cm-operator">-</span><span class="cm-number">20</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">4</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>:  <span class="cm-number">40</span>, <span class="cm-property">bananas</span>: <span class="cm-number">100</span>, <span class="cm-property">cherries</span>: <span class="cm-number">64</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">115</span>, <span class="cm-property">grapes</span>: <span class="cm-operator">-</span><span class="cm-number">45</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">5</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">100</span>, <span class="cm-property">bananas</span>: <span class="cm-operator">-</span><span class="cm-number">25</span>, <span class="cm-property">cherries</span>: <span class="cm-number">86</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-operator">-</span><span class="cm-number">225</span>, <span class="cm-property">grapes</span>: <span class="cm-number">50</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">6</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">150</span>, <span class="cm-property">bananas</span>: <span class="cm-operator">-</span><span class="cm-number">125</span>, <span class="cm-property">cherries</span>: <span class="cm-number">96</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-operator">-</span><span class="cm-number">200</span>, <span class="cm-property">grapes</span>: <span class="cm-number">15</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">7</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">100</span>, <span class="cm-property">bananas</span>:  <span class="cm-operator">-</span><span class="cm-number">75</span>, <span class="cm-property">cherries</span>: <span class="cm-number">106</span>, <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-operator">-</span><span class="cm-number">210</span>, <span class="cm-property">grapes</span>: <span class="cm-number">10</span>}}
];

<span class="cm-keyword">var</span> <span class="cm-def">xScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleTime</span>().<span class="cm-property">domain</span>([<span class="cm-variable">data</span>[<span class="cm-number">0</span>].<span class="cm-property">month</span>, <span class="cm-variable">data</span>[<span class="cm-variable">data</span>.<span class="cm-property">length</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>].<span class="cm-property">month</span>]).<span class="cm-property">range</span>([<span class="cm-number">50</span><span class="cm-operator">+</span><span class="cm-number">225</span><span class="cm-operator">/</span><span class="cm-variable">data</span>.<span class="cm-property">length</span><span class="cm-operator">/</span><span class="cm-number">2</span>, <span class="cm-number">275</span> <span class="cm-operator">-</span> <span class="cm-number">225</span><span class="cm-operator">/</span><span class="cm-variable">data</span>.<span class="cm-property">length</span><span class="cm-operator">/</span><span class="cm-number">2</span>]);
<span class="cm-keyword">var</span> <span class="cm-def">yScaleDiv</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleLinear</span>().<span class="cm-property">domain</span>([<span class="cm-operator">-</span><span class="cm-number">1000</span>,<span class="cm-number">1000</span>]).<span class="cm-property">range</span>([<span class="cm-number">275</span>,<span class="cm-number">25</span>]);
<span class="cm-keyword">var</span> <span class="cm-def">colorScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleOrdinal</span>()
  .<span class="cm-property">domain</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;cherries&quot;</span>, <span class="cm-string">&quot;dates&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>, <span class="cm-string">&quot;grapes&quot;</span>])
  .<span class="cm-property">range</span>([<span class="cm-string">&quot;red&quot;</span>, <span class="cm-string">&quot;yellow&quot;</span>, <span class="cm-string">&quot;pink&quot;</span>, <span class="cm-string">&quot;brown&quot;</span>, <span class="cm-string">&quot;orange&quot;</span>, <span class="cm-string">&quot;purple&quot;</span>]);

<span class="cm-keyword">var</span> <span class="cm-def">stack</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">stack</span>() 
  .<span class="cm-property">keys</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;cherries&quot;</span>, <span class="cm-string">&quot;dates&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>, <span class="cm-string">&quot;grapes&quot;</span>])
  .<span class="cm-property">value</span>((<span class="cm-def">d</span>, <span class="cm-def">key</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">d</span>.<span class="cm-property">fruitSales</span>[<span class="cm-variable-2">key</span>])
  .<span class="cm-property">order</span>(<span class="cm-variable">d3</span>.<span class="cm-property">stackOrderNone</span>)
  .<span class="cm-property">offset</span>(<span class="cm-variable">d3</span>.<span class="cm-property">stackOffsetDiverging</span>);
  
<span class="cm-keyword">var</span> <span class="cm-def">stackedSeries</span> <span class="cm-operator">=</span> <span class="cm-variable">stack</span>(<span class="cm-variable">data</span>);

<span class="cm-variable">addAxis</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo8d&quot;</span>), <span class="cm-variable">data</span>, <span class="cm-variable">xScale</span>, <span class="cm-variable">yScaleDiv</span>);
<span class="cm-variable">addAxis</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo8d&quot;</span>), <span class="cm-atom">null</span>, <span class="cm-variable">d3</span>.<span class="cm-property">scaleTime</span>().<span class="cm-property">range</span>([<span class="cm-number">50</span>,<span class="cm-number">275</span>]), <span class="cm-atom">null</span>);

<span class="cm-comment">// Create a g element for each series</span>
<span class="cm-keyword">var</span> <span class="cm-def">g</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo8d&quot;</span>)
  .<span class="cm-property">select</span>(<span class="cm-string">'#stack'</span>)
  .<span class="cm-property">selectAll</span>(<span class="cm-string">'g.series'</span>)
  .<span class="cm-property">data</span>(<span class="cm-variable">stackedSeries</span>)
  .<span class="cm-property">join</span>(<span class="cm-string">'g'</span>)
  .<span class="cm-property">classed</span>(<span class="cm-string">'series'</span>, <span class="cm-atom">true</span>)
  .<span class="cm-property">style</span>(<span class="cm-string">'fill'</span>, (<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">colorScale</span>(<span class="cm-variable-2">d</span>.<span class="cm-property">key</span>));

<span class="cm-comment">// For each series create a rect element for each month</span>
<span class="cm-variable">g</span>.<span class="cm-property">selectAll</span>(<span class="cm-string">'rect'</span>)
  .<span class="cm-property">data</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">d</span>)
  .<span class="cm-property">join</span>(<span class="cm-string">'rect'</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">'width'</span>, <span class="cm-number">225</span><span class="cm-operator">/</span><span class="cm-variable">data</span>.<span class="cm-property">length</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">'y'</span>, (<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScaleDiv</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">1</span>]))
  .<span class="cm-property">attr</span>(<span class="cm-string">'x'</span>, (<span class="cm-def">d</span>, <span class="cm-def">i</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">i</span> <span class="cm-operator">*</span> (<span class="cm-number">225</span><span class="cm-operator">/</span><span class="cm-variable">data</span>.<span class="cm-property">length</span>) <span class="cm-operator">+</span> <span class="cm-number">50</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">'height'</span>, (<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScaleDiv</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">0</span>]) <span class="cm-operator">-</span>  <span class="cm-variable">yScaleDiv</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">1</span>])); 
    
<span class="cm-comment">//Adds in the baseline</span>
<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#baseline8&quot;</span>)
  .<span class="cm-property">append</span>(<span class="cm-string">&quot;path&quot;</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">&quot;d&quot;</span>, <span class="cm-string">&quot;M 25 &quot;</span> <span class="cm-operator">+</span> <span class="cm-variable">yScaleDiv</span>(<span class="cm-number">0</span>) <span class="cm-operator">+</span> <span class="cm-string">&quot; l 325 0&quot;</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">&quot;stroke&quot;</span>, <span class="cm-string">&quot;black&quot;</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">&quot;stroke-dasharray&quot;</span>, <span class="cm-string">&quot;10,5&quot;</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">&quot;stroke-width&quot;</span>, <span class="cm-string">&quot;2px&quot;</span>);
  
<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#baseline8&quot;</span>)
  .<span class="cm-property">append</span>(<span class="cm-string">&quot;text&quot;</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">&quot;x&quot;</span>, <span class="cm-number">0</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">&quot;y&quot;</span>, <span class="cm-variable">yScaleDiv</span>(<span class="cm-number">0</span>) <span class="cm-operator">-</span> <span class="cm-number">10</span>)
  .<span class="cm-property">text</span>(<span class="cm-string">&quot;Baseline&quot;</span>); 
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>

<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">svg</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;demo8d&quot;</span> <span class="cm-attribute">width</span>=<span class="cm-string">&quot;300&quot;</span> <span class="cm-attribute">height</span>=<span class="cm-string">&quot;300&quot;</span><span class="cm-tag cm-bracket">&gt;</span>
    <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">g</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;stack&quot;</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">g</span><span class="cm-tag cm-bracket">&gt;</span>
    <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">g</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;baseline8&quot;</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">g</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">svg</span><span class="cm-tag cm-bracket">&gt;</span></pre><figure class="sandbox"><figcaption>Figure 10. A bar graph using d3.stackOffsetDiverging. </figcaption></figure>


<p><a class="p_ident" id="p_UEXZ/A/Puj" href="#p_UEXZ/A/Puj" tabindex="-1" role="presentation"></a>The <code>d3.<wbr>stackOffsetSilhouette</code> and <code>d3.<wbr>stackOffsetWiggle</code> offset functions create streamgraphs.</p>

<ul>

<li>

<p><a class="p_ident" id="p_fQeFPazZ/T" href="#p_fQeFPazZ/T" tabindex="-1" role="presentation"></a><a href="https://github.com/d3/d3-shape#stackOffsetSilhouette">d3.stackOffsetSilhouette(series, order)</a> - positions the series symmetrically about the baseline.</p></li>

<li>

<p><a class="p_ident" id="p_nybkQoyr5f" href="#p_nybkQoyr5f" tabindex="-1" role="presentation"></a><a href="https://github.com/d3/d3-shape#stackOffsetWiggle">d3.stackOffsetWiggle(series, order)</a> - positions the series so that the <em>wiggle</em> in each series is minimized. This offset function is recommended for streamgraphs alongside <code>d3.<wbr>stackOrderInsideOut())</code>.</p></li></ul>

<pre class="snippet cm-s-default" data-language="html" data-edit="editable" data-cm="hidden" ><a class="c_ident" id="c_swN7aLTU28" href="#c_swN7aLTU28" tabindex="-1" role="presentation"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-keyword">var</span> <span class="cm-def">data</span> <span class="cm-operator">=</span> [
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">0</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">400</span>, <span class="cm-property">bananas</span>: <span class="cm-number">200</span>, <span class="cm-property">cherries</span>: <span class="cm-number">96</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">250</span>, <span class="cm-property">grapes</span>: <span class="cm-number">20</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">160</span>, <span class="cm-property">bananas</span>: <span class="cm-number">150</span>, <span class="cm-property">cherries</span>: <span class="cm-number">96</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">200</span>, <span class="cm-property">grapes</span>: <span class="cm-number">25</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">2</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>:  <span class="cm-number">64</span>, <span class="cm-property">bananas</span>:  <span class="cm-number">96</span>, <span class="cm-property">cherries</span>: <span class="cm-number">64</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">150</span>, <span class="cm-property">grapes</span>: <span class="cm-number">30</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">3</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>:  <span class="cm-number">32</span>, <span class="cm-property">bananas</span>:  <span class="cm-number">48</span>, <span class="cm-property">cherries</span>: <span class="cm-number">64</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">100</span>, <span class="cm-property">grapes</span>: <span class="cm-number">20</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">4</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>:  <span class="cm-number">40</span>, <span class="cm-property">bananas</span>: <span class="cm-number">100</span>, <span class="cm-property">cherries</span>: <span class="cm-number">64</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">115</span>, <span class="cm-property">grapes</span>: <span class="cm-number">45</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">5</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">100</span>, <span class="cm-property">bananas</span>: <span class="cm-number">250</span> , <span class="cm-property">cherries</span>: <span class="cm-number">86</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">225</span>, <span class="cm-property">grapes</span>: <span class="cm-number">50</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">6</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">150</span>, <span class="cm-property">bananas</span>: <span class="cm-number">125</span>, <span class="cm-property">cherries</span>: <span class="cm-number">96</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">200</span>, <span class="cm-property">grapes</span>: <span class="cm-number">15</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">7</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">100</span>, <span class="cm-property">bananas</span>:  <span class="cm-number">75</span>, <span class="cm-property">cherries</span>: <span class="cm-number">106</span>, <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">210</span>, <span class="cm-property">grapes</span>: <span class="cm-number">10</span>}}
];

<span class="cm-keyword">var</span> <span class="cm-def">xScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleTime</span>().<span class="cm-property">domain</span>([<span class="cm-variable">data</span>[<span class="cm-number">0</span>].<span class="cm-property">month</span>, <span class="cm-variable">data</span>[<span class="cm-variable">data</span>.<span class="cm-property">length</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>].<span class="cm-property">month</span>]).<span class="cm-property">range</span>([<span class="cm-number">50</span>,<span class="cm-number">275</span>]);
<span class="cm-keyword">var</span> <span class="cm-def">yScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleLinear</span>().<span class="cm-property">domain</span>([<span class="cm-number">0</span>,<span class="cm-number">1000</span>]).<span class="cm-property">range</span>([<span class="cm-number">275</span>,<span class="cm-number">25</span>]);
<span class="cm-keyword">var</span> <span class="cm-def">colorScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleOrdinal</span>()
  .<span class="cm-property">domain</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;cherries&quot;</span>, <span class="cm-string">&quot;dates&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>, <span class="cm-string">&quot;grapes&quot;</span>])
  .<span class="cm-property">range</span>([<span class="cm-string">&quot;red&quot;</span>, <span class="cm-string">&quot;yellow&quot;</span>, <span class="cm-string">&quot;pink&quot;</span>, <span class="cm-string">&quot;brown&quot;</span>, <span class="cm-string">&quot;orange&quot;</span>, <span class="cm-string">&quot;purple&quot;</span>]);

<span class="cm-keyword">var</span> <span class="cm-def">stack1</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">stack</span>() 
  .<span class="cm-property">keys</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;cherries&quot;</span>, <span class="cm-string">&quot;dates&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>, <span class="cm-string">&quot;grapes&quot;</span>])
  .<span class="cm-property">value</span>((<span class="cm-def">d</span>, <span class="cm-def">key</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">d</span>.<span class="cm-property">fruitSales</span>[<span class="cm-variable-2">key</span>])
  .<span class="cm-property">order</span>(<span class="cm-variable">d3</span>.<span class="cm-property">stackOrderNone</span>)
  .<span class="cm-property">offset</span>(<span class="cm-variable">d3</span>.<span class="cm-property">stackOffsetSilhouette</span>);
        
<span class="cm-keyword">var</span> <span class="cm-def">stackedSeries1</span> <span class="cm-operator">=</span> <span class="cm-variable">stack1</span>(<span class="cm-variable">data</span>);

<span class="cm-keyword">var</span> <span class="cm-def">stack2</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">stack</span>()
  .<span class="cm-property">keys</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;cherries&quot;</span>, <span class="cm-string">&quot;dates&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>, <span class="cm-string">&quot;grapes&quot;</span>])
  .<span class="cm-property">value</span>((<span class="cm-def">d</span>, <span class="cm-def">key</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">d</span>.<span class="cm-property">fruitSales</span>[<span class="cm-variable-2">key</span>])
  .<span class="cm-property">order</span>(<span class="cm-variable">d3</span>.<span class="cm-property">stackOrderInsideOut</span>)
  .<span class="cm-property">offset</span>(<span class="cm-variable">d3</span>.<span class="cm-property">stackOffsetWiggle</span>);
  
<span class="cm-keyword">var</span> <span class="cm-def">stackedSeries2</span> <span class="cm-operator">=</span> <span class="cm-variable">stack2</span>(<span class="cm-variable">data</span>);

<span class="cm-keyword">var</span> <span class="cm-def">area</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">area</span>()
  .<span class="cm-property">x</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">xScale</span>(<span class="cm-variable-2">d</span>.<span class="cm-property">data</span>.<span class="cm-property">month</span>))
  .<span class="cm-property">y0</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScale</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">0</span>]))
  .<span class="cm-property">y1</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScale</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">1</span>]))
  .<span class="cm-property">curve</span>(<span class="cm-variable">d3</span>.<span class="cm-property">curveBasis</span>);

<span class="cm-variable">addAreas</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo9s&quot;</span>)
  .<span class="cm-property">select</span>(<span class="cm-string">&quot;#stack9s&quot;</span>), <span class="cm-variable">stackedSeries1</span>, <span class="cm-variable">area</span>, <span class="cm-string">&quot;translate(0, -150)&quot;</span>); <span class="cm-comment">// Areas to stackOffsetSilhouette</span>
  
<span class="cm-variable">addAreas</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo9w&quot;</span>)
  .<span class="cm-property">select</span>(<span class="cm-string">&quot;#stack9w&quot;</span>), <span class="cm-variable">stackedSeries2</span>, <span class="cm-variable">area</span>); <span class="cm-comment">// Areas to stackOrderReverse // Areas to stackOffsetWiggle</span>

<span class="cm-variable">addLabels</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo9s&quot;</span>)
  .<span class="cm-property">select</span>(<span class="cm-string">&quot;#stack9s&quot;</span>)
  .<span class="cm-property">append</span>(<span class="cm-string">&quot;g&quot;</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">&quot;transform&quot;</span>, <span class="cm-string">&quot;translate(0, -150)&quot;</span>), <span class="cm-variable">stackedSeries1</span>, <span class="cm-variable">area</span>); 

<span class="cm-variable">addLabels</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo9w&quot;</span>)
  .<span class="cm-property">select</span>(<span class="cm-string">&quot;#stack9w&quot;</span>), <span class="cm-variable">stackedSeries2</span>, <span class="cm-variable">area</span>);

<span class="cm-comment">//Adds the baseline the Silhouette</span>
<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#baseline9s&quot;</span>)
  .<span class="cm-property">append</span>(<span class="cm-string">&quot;path&quot;</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">&quot;d&quot;</span>, <span class="cm-string">&quot;M 25 &quot;</span> <span class="cm-operator">+</span> <span class="cm-variable">yScale</span>(<span class="cm-number">0</span>) <span class="cm-operator">+</span> <span class="cm-string">&quot; l 325 0&quot;</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">&quot;stroke-dasharray&quot;</span>, <span class="cm-string">&quot;10,5&quot;</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">&quot;stroke&quot;</span>, <span class="cm-string">&quot;black&quot;</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">&quot;stroke-width&quot;</span>, <span class="cm-string">&quot;2px&quot;</span>);

<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#baseline9s&quot;</span>)
  .<span class="cm-property">append</span>(<span class="cm-string">&quot;text&quot;</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">&quot;x&quot;</span>, <span class="cm-number">0</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">&quot;y&quot;</span>, <span class="cm-variable">yScale</span>(<span class="cm-number">0</span>) <span class="cm-operator">-</span> <span class="cm-number">10</span>)
  .<span class="cm-property">text</span>(<span class="cm-string">&quot;Baseline&quot;</span>);
    
  <span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#baseline9w&quot;</span>)
  .<span class="cm-property">append</span>(<span class="cm-string">&quot;path&quot;</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">&quot;d&quot;</span>, <span class="cm-string">&quot;M 25 &quot;</span> <span class="cm-operator">+</span> <span class="cm-variable">yScale</span>(<span class="cm-number">0</span>) <span class="cm-operator">+</span> <span class="cm-string">&quot; l 325 0&quot;</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">&quot;stroke-dasharray&quot;</span>, <span class="cm-string">&quot;10,5&quot;</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">&quot;stroke&quot;</span>, <span class="cm-string">&quot;black&quot;</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">&quot;stroke-width&quot;</span>, <span class="cm-string">&quot;2px&quot;</span>);
  
  <span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#baseline9w&quot;</span>)
  .<span class="cm-property">append</span>(<span class="cm-string">&quot;text&quot;</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">&quot;x&quot;</span>, <span class="cm-number">0</span>)
  .<span class="cm-property">attr</span>(<span class="cm-string">&quot;y&quot;</span>, <span class="cm-variable">yScale</span>(<span class="cm-number">0</span>) <span class="cm-operator">-</span> <span class="cm-number">10</span>)
  .<span class="cm-property">text</span>(<span class="cm-string">&quot;Baseline&quot;</span>);
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>

<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">svg</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;demo9s&quot;</span> <span class="cm-attribute">width</span>=<span class="cm-string">&quot;300&quot;</span> <span class="cm-attribute">height</span>=<span class="cm-string">&quot;300&quot;</span><span class="cm-tag cm-bracket">&gt;</span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">g</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;stack9s&quot;</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">g</span><span class="cm-tag cm-bracket">&gt;</span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">g</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;baseline9s&quot;</span> <span class="cm-attribute">transform</span>=<span class="cm-string">&quot;translate(0,-150)&quot;</span><span class="cm-attribute">)</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">g</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">svg</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">svg</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;demo9w&quot;</span> <span class="cm-attribute">width</span>=<span class="cm-string">&quot;300&quot;</span> <span class="cm-attribute">height</span>=<span class="cm-string">&quot;300&quot;</span><span class="cm-tag cm-bracket">&gt;</span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">g</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;stack9w&quot;</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">g</span><span class="cm-tag cm-bracket">&gt;</span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">g</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;baseline9w&quot;</span><span class="cm-attribute">)</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">g</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">svg</span><span class="cm-tag cm-bracket">&gt;</span></pre><figure class="sandbox"><figcaption>Figure 11. Stacks using d3.stackOffsetSilhouette (left) and d3.stackOffsetWiggle (right). </figcaption></figure>


<p><a class="p_ident" id="p_VABNlz3Bmo" href="#p_VABNlz3Bmo" tabindex="-1" role="presentation"></a>The last offset function is <code>d3.<wbr>stackOffsetExpand</code> which positions the series so that the bottom series is bounded below by <em>y=0</em> and the top series is bounded above by <em>y=1</em>.</p>

<ul>

<li>

<p><a class="p_ident" id="p_/XzBifCXBK" href="#p_/XzBifCXBK" tabindex="-1" role="presentation"></a><a href="https://github.com/d3/d3-shape#stackOffsetExpand">d3.stackOffsetExpand(series, order)</a> - Normalizes every point to be within the range <code>[</code>0,1<code>]</code>.</p></li></ul>

<pre class="snippet cm-s-default" data-language="html" data-edit="editable" data-cm="hidden" ><a class="c_ident" id="c_+/fgwdPePR" href="#c_+/fgwdPePR" tabindex="-1" role="presentation"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-keyword">var</span> <span class="cm-def">data</span> <span class="cm-operator">=</span> [
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">0</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">400</span>, <span class="cm-property">bananas</span>: <span class="cm-number">200</span>, <span class="cm-property">cherries</span>: <span class="cm-number">96</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">250</span>, <span class="cm-property">grapes</span>: <span class="cm-number">20</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">160</span>, <span class="cm-property">bananas</span>: <span class="cm-number">150</span>, <span class="cm-property">cherries</span>: <span class="cm-number">96</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">200</span>, <span class="cm-property">grapes</span>: <span class="cm-number">25</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">2</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>:  <span class="cm-number">64</span>, <span class="cm-property">bananas</span>:  <span class="cm-number">96</span>, <span class="cm-property">cherries</span>: <span class="cm-number">64</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">150</span>, <span class="cm-property">grapes</span>: <span class="cm-number">30</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">3</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>:  <span class="cm-number">32</span>, <span class="cm-property">bananas</span>:  <span class="cm-number">48</span>, <span class="cm-property">cherries</span>: <span class="cm-number">64</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">100</span>, <span class="cm-property">grapes</span>: <span class="cm-number">20</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">4</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>:  <span class="cm-number">40</span>, <span class="cm-property">bananas</span>: <span class="cm-number">100</span>, <span class="cm-property">cherries</span>: <span class="cm-number">64</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">115</span>, <span class="cm-property">grapes</span>: <span class="cm-number">45</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">5</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">100</span>, <span class="cm-property">bananas</span>: <span class="cm-number">250</span>, <span class="cm-property">cherries</span>: <span class="cm-number">86</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">225</span>, <span class="cm-property">grapes</span>: <span class="cm-number">50</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">6</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">150</span>, <span class="cm-property">bananas</span>: <span class="cm-number">125</span>, <span class="cm-property">cherries</span>: <span class="cm-number">96</span>,  <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">200</span>, <span class="cm-property">grapes</span>: <span class="cm-number">15</span>}},
    {<span class="cm-property">month</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(<span class="cm-number">2018</span>, <span class="cm-number">7</span>, <span class="cm-number">1</span>), <span class="cm-property">fruitSales</span>: {<span class="cm-property">apples</span>: <span class="cm-number">100</span>, <span class="cm-property">bananas</span>:  <span class="cm-number">75</span>, <span class="cm-property">cherries</span>: <span class="cm-number">106</span>, <span class="cm-property">dates</span>: <span class="cm-number">40</span>, <span class="cm-property">oranges</span>: <span class="cm-number">210</span>, <span class="cm-property">grapes</span>: <span class="cm-number">10</span>}}
];

<span class="cm-keyword">var</span> <span class="cm-def">xScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleTime</span>().<span class="cm-property">domain</span>([<span class="cm-variable">data</span>[<span class="cm-number">0</span>].<span class="cm-property">month</span>, <span class="cm-variable">data</span>[<span class="cm-variable">data</span>.<span class="cm-property">length</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>].<span class="cm-property">month</span>]).<span class="cm-property">range</span>([<span class="cm-number">50</span>,<span class="cm-number">275</span>]);
<span class="cm-keyword">var</span> <span class="cm-def">yScaleNone</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleLinear</span>().<span class="cm-property">domain</span>([<span class="cm-number">0</span>,<span class="cm-number">1000</span>]).<span class="cm-property">range</span>([<span class="cm-number">275</span>,<span class="cm-number">25</span>]);
<span class="cm-keyword">var</span> <span class="cm-def">yScaleExpand</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleLinear</span>().<span class="cm-property">domain</span>([<span class="cm-number">0</span>,<span class="cm-number">1</span>]).<span class="cm-property">range</span>([<span class="cm-number">275</span>,<span class="cm-number">25</span>]);
<span class="cm-keyword">var</span> <span class="cm-def">colorScale</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">scaleOrdinal</span>()
  .<span class="cm-property">domain</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;cherries&quot;</span>, <span class="cm-string">&quot;dates&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>, <span class="cm-string">&quot;grapes&quot;</span>])
  .<span class="cm-property">range</span>([<span class="cm-string">&quot;red&quot;</span>, <span class="cm-string">&quot;yellow&quot;</span>, <span class="cm-string">&quot;pink&quot;</span>, <span class="cm-string">&quot;brown&quot;</span>, <span class="cm-string">&quot;orange&quot;</span>, <span class="cm-string">&quot;purple&quot;</span>]);

<span class="cm-keyword">var</span> <span class="cm-def">stack2</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">stack</span>()
  .<span class="cm-property">keys</span>([<span class="cm-string">&quot;apples&quot;</span>, <span class="cm-string">&quot;bananas&quot;</span>, <span class="cm-string">&quot;cherries&quot;</span>, <span class="cm-string">&quot;dates&quot;</span>, <span class="cm-string">&quot;oranges&quot;</span>, <span class="cm-string">&quot;grapes&quot;</span>])
  .<span class="cm-property">value</span>((<span class="cm-def">d</span>, <span class="cm-def">key</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">d</span>.<span class="cm-property">fruitSales</span>[<span class="cm-variable-2">key</span>])
  .<span class="cm-property">order</span>(<span class="cm-variable">d3</span>.<span class="cm-property">stackOrderNone</span>)
  .<span class="cm-property">offset</span>(<span class="cm-variable">d3</span>.<span class="cm-property">stackOffsetExpand</span>);
        
<span class="cm-keyword">var</span> <span class="cm-def">stackedSeries2</span> <span class="cm-operator">=</span> <span class="cm-variable">stack2</span>(<span class="cm-variable">data</span>);
    
<span class="cm-keyword">var</span> <span class="cm-def">areaExpanding</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">area</span>()
  .<span class="cm-property">x</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">xScale</span>(<span class="cm-variable-2">d</span>.<span class="cm-property">data</span>.<span class="cm-property">month</span>))
  .<span class="cm-property">y0</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScaleExpand</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">0</span>]))
  .<span class="cm-property">y1</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">yScaleExpand</span>(<span class="cm-variable-2">d</span>[<span class="cm-number">1</span>]))
  .<span class="cm-property">curve</span>(<span class="cm-variable">d3</span>.<span class="cm-property">curveBasis</span>);

<span class="cm-variable">addAreas</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo12&quot;</span>).<span class="cm-property">select</span>(<span class="cm-string">&quot;#stack&quot;</span>), <span class="cm-variable">stackedSeries2</span>, <span class="cm-variable">areaExpanding</span>);
<span class="cm-variable">addLabels</span>(<span class="cm-variable">d3</span>.<span class="cm-property">select</span>(<span class="cm-string">&quot;#demo12&quot;</span>).<span class="cm-property">select</span>(<span class="cm-string">&quot;#stack&quot;</span>), <span class="cm-variable">stackedSeries2</span>, <span class="cm-variable">areaExpanding</span>);
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>

<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">svg</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;demo12&quot;</span> <span class="cm-attribute">width</span>=<span class="cm-string">&quot;300&quot;</span> <span class="cm-attribute">height</span>=<span class="cm-string">&quot;300&quot;</span><span class="cm-tag cm-bracket">&gt;</span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">g</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;stack&quot;</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">g</span><span class="cm-tag cm-bracket">&gt;</span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">g</span> <span class="cm-attribute">id</span>=<span class="cm-string">&quot;baseline&quot;</span><span class="cm-tag cm-bracket">&gt;</span>
  		<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">text</span> <span class="cm-attribute">x</span>=<span class="cm-string">&quot;&quot;</span> <span class="cm-attribute">y</span>=<span class="cm-string">&quot;290&quot;</span><span class="cm-tag cm-bracket">&gt;</span>Baseline<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">text</span><span class="cm-tag cm-bracket">&gt;</span>
        <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">text</span> <span class="cm-attribute">x</span>=<span class="cm-string">&quot;290&quot;</span> <span class="cm-attribute">y</span>=<span class="cm-string">&quot;270&quot;</span><span class="cm-tag cm-bracket">&gt;</span>0<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">text</span><span class="cm-tag cm-bracket">&gt;</span>
        <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">text</span> <span class="cm-attribute">x</span>=<span class="cm-string">&quot;290&quot;</span> <span class="cm-attribute">y</span>=<span class="cm-string">&quot;40&quot;</span><span class="cm-tag cm-bracket">&gt;</span>1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">text</span><span class="cm-tag cm-bracket">&gt;</span>
        <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">path</span> <span class="cm-attribute">d</span>=<span class="cm-string">&quot;M 25 25 l 325 0&quot;</span> <span class="cm-attribute">stroke</span>=<span class="cm-string">&quot;black&quot;</span> <span class="cm-attribute">stroke-dasharray</span>=<span class="cm-string">&quot;10,5&quot;</span> <span class="cm-attribute">stroke-width</span>=<span class="cm-string">&quot;2px&quot;</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">path</span><span class="cm-tag cm-bracket">&gt;</span>
        <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">path</span> <span class="cm-attribute">d</span>=<span class="cm-string">&quot;M 25 275 l 325 0&quot;</span> <span class="cm-attribute">stroke</span>=<span class="cm-string">&quot;black&quot;</span> <span class="cm-attribute">stroke-dasharray</span>=<span class="cm-string">&quot;10,5&quot;</span> <span class="cm-attribute">stroke-width</span>=<span class="cm-string">&quot;2px&quot;</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">path</span><span class="cm-tag cm-bracket">&gt;</span>
  <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">g</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">svg</span><span class="cm-tag cm-bracket">&gt;</span></pre><figure class="sandbox"><figcaption>Figure 12. A stack using d3.stackOffsetExpand. </figcaption></figure>
<aside>


<h2><a class="h_ident" id="h_N1sY1ommPg" href="#h_N1sY1ommPg" tabindex="-1" role="presentation"></a>In case you were wondering ...</h2>

<p><a class="p_ident" id="p_Ho6MF/DUIx" href="#p_Ho6MF/DUIx" tabindex="-1" role="presentation"></a>The following function was used to create the areas for the ordering examples.</p>

<pre class="snippet cm-s-default" data-language="html" data-edit="editable" data-cm="hidden" ><a class="c_ident" id="c_SxN57dPl5F" href="#c_SxN57dPl5F" tabindex="-1" role="presentation"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>
    <span class="cm-keyword">function</span> <span class="cm-def">addAreas</span>(<span class="cm-def">selection</span>, <span class="cm-def">data</span>, <span class="cm-def">area</span>, <span class="cm-def">customTransform</span>){ <span class="cm-comment">//customTransform not neccesary</span>
        <span class="cm-variable-2">selection</span>.<span class="cm-property">selectAll</span>(<span class="cm-string">&quot;.areas&quot;</span>)
            .<span class="cm-property">data</span>(<span class="cm-variable-2">data</span>)
            .<span class="cm-property">join</span>(<span class="cm-string">&quot;path&quot;</span>)
            .<span class="cm-property">attr</span>(<span class="cm-string">&quot;d&quot;</span>, <span class="cm-variable-2">area</span>)
            .<span class="cm-property">attr</span>(<span class="cm-string">&quot;fill&quot;</span>, (<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable">colorScale</span>(<span class="cm-variable-2">d</span>.<span class="cm-property">key</span>))
            .<span class="cm-property">attr</span>(<span class="cm-string">&quot;transform&quot;</span> , <span class="cm-variable-2">customTransform</span>);
    }
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">code</span><span class="cm-tag cm-bracket">&gt;</span>addAreas(selection, data, area, customTransform)<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">code</span><span class="cm-tag cm-bracket">&gt;</span></pre>

<p><a class="p_ident" id="p_JDM70I7Gu4" href="#p_JDM70I7Gu4" tabindex="-1" role="presentation"></a>The function <code>addAxis</code>, shown below, is used to determine the scales and add axis to some stacks on this page. If you need a refresher on axis, please see <a href="./04_03_axis.html">axis</a>. It may seem complex at first, but the function checks for <code>null</code> frequently so that we can only use what we need.</p>

<pre class="snippet cm-s-default" data-language="html" data-edit="editable" data-cm="hidden" ><a class="c_ident" id="c_sx6voFAvkz" href="#c_sx6voFAvkz" tabindex="-1" role="presentation"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-keyword">function</span> <span class="cm-def">addAxis</span>(<span class="cm-def">svgSel</span>, <span class="cm-def">d</span>, <span class="cm-def">xscale</span>, <span class="cm-def">yscale</span>, <span class="cm-def">firstStack</span>){
  <span class="cm-keyword">let</span> <span class="cm-def">dates</span>, <span class="cm-def">maxPValues</span>, <span class="cm-def">maxNValues</span>, <span class="cm-def">blankAxis</span>;
  
  <span class="cm-keyword">if</span>(<span class="cm-variable-2">d</span>){
    <span class="cm-variable-2">dates</span> <span class="cm-operator">=</span> <span class="cm-variable-2">d</span>.<span class="cm-property">map</span>( (<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">d</span>.<span class="cm-property">month</span> );
    <span class="cm-keyword">if</span>(<span class="cm-variable-2">firstStack</span>){
      <span class="cm-variable-2">maxPValues</span> <span class="cm-operator">=</span> <span class="cm-variable-2">d</span>.<span class="cm-property">map</span>( (<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> {
        <span class="cm-keyword">let</span> <span class="cm-def">sum</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;
        <span class="cm-keyword">for</span>(<span class="cm-keyword">let</span> [<span class="cm-def">key</span>, <span class="cm-def">value</span>] <span class="cm-keyword">of</span> <span class="cm-variable">Object</span>.<span class="cm-property">entries</span>(<span class="cm-variable-2">d</span>)){ <span class="cm-variable-2">sum</span> <span class="cm-operator">+=</span> <span class="cm-variable-2">key</span> <span class="cm-operator">!=</span> <span class="cm-string">&quot;month&quot;</span> <span class="cm-operator">?</span> <span class="cm-variable-2">value</span> : <span class="cm-number">0</span>; }
        <span class="cm-keyword">return</span> <span class="cm-variable-2">sum</span>;
       });
      <span class="cm-variable-2">maxNValues</span> <span class="cm-operator">=</span> [<span class="cm-number">0</span>,<span class="cm-number">0</span>]; 
    }
    <span class="cm-keyword">else</span> {
      <span class="cm-variable-2">maxPValues</span> <span class="cm-operator">=</span> <span class="cm-variable-2">d</span>.<span class="cm-property">map</span>( (<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> {
        <span class="cm-keyword">let</span> <span class="cm-def">sum</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;
        <span class="cm-keyword">for</span>(<span class="cm-keyword">let</span> [<span class="cm-def">key</span>, <span class="cm-def">value</span>] <span class="cm-keyword">of</span> <span class="cm-variable">Object</span>.<span class="cm-property">entries</span>(<span class="cm-variable-2">d</span>.<span class="cm-property">fruitSales</span>)){ <span class="cm-variable-2">sum</span> <span class="cm-operator">+=</span> <span class="cm-variable-2">key</span> <span class="cm-operator">!=</span> <span class="cm-string">&quot;month&quot;</span> <span class="cm-operator">?</span> (<span class="cm-variable-2">value</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span> <span class="cm-operator">?</span> <span class="cm-variable-2">value</span> : <span class="cm-number">0</span>): <span class="cm-number">0</span>; }
        <span class="cm-keyword">return</span> <span class="cm-variable-2">sum</span>;
       });
      <span class="cm-variable-2">maxPValues</span>.<span class="cm-property">push</span>(<span class="cm-number">0</span>);
      
      <span class="cm-variable-2">maxNValues</span> <span class="cm-operator">=</span> <span class="cm-variable-2">d</span>.<span class="cm-property">map</span>( (<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> {
        <span class="cm-keyword">let</span> <span class="cm-def">sum</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;
        <span class="cm-keyword">for</span>(<span class="cm-keyword">let</span> [<span class="cm-def">key</span>, <span class="cm-def">value</span>] <span class="cm-keyword">of</span> <span class="cm-variable">Object</span>.<span class="cm-property">entries</span>(<span class="cm-variable-2">d</span>.<span class="cm-property">fruitSales</span>)){ <span class="cm-variable-2">sum</span> <span class="cm-operator">+=</span> <span class="cm-variable-2">key</span> <span class="cm-operator">!=</span> <span class="cm-string">&quot;month&quot;</span> <span class="cm-operator">?</span> (<span class="cm-variable-2">value</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0</span> <span class="cm-operator">?</span> <span class="cm-variable-2">value</span> : <span class="cm-number">0</span> ): <span class="cm-number">0</span>; }
        <span class="cm-keyword">return</span> <span class="cm-variable-2">sum</span>;
       });
      <span class="cm-variable-2">maxNValues</span>.<span class="cm-property">push</span>(<span class="cm-number">0</span>);
      }
  }
  <span class="cm-keyword">else</span>{
    <span class="cm-variable-2">dates</span> <span class="cm-operator">=</span> [<span class="cm-number">0</span>,<span class="cm-number">0</span>];
    <span class="cm-variable-2">blankAxis</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;
    <span class="cm-variable-2">maxPValues</span> <span class="cm-operator">=</span> [<span class="cm-number">0</span>,<span class="cm-number">0</span>];
    <span class="cm-variable-2">maxNValues</span> <span class="cm-operator">=</span> [<span class="cm-number">0</span>,<span class="cm-number">0</span>];
  }
  
  <span class="cm-keyword">if</span>(<span class="cm-variable-2">xscale</span>){
    <span class="cm-variable-2">xscale</span>.<span class="cm-property">domain</span>([<span class="cm-variable-2">dates</span>[<span class="cm-number">0</span>], <span class="cm-variable-2">dates</span>[<span class="cm-variable-2">dates</span>.<span class="cm-property">length</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>]]);
    <span class="cm-comment">// Add xAxis</span>
    <span class="cm-keyword">let</span> <span class="cm-def">xAxis</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">axisBottom</span>(<span class="cm-variable-2">xscale</span>)
      .<span class="cm-property">tickValues</span>(<span class="cm-variable-2">blankAxis</span> <span class="cm-operator">?</span> [] : <span class="cm-variable-2">dates</span>)
      .<span class="cm-property">tickFormat</span>(<span class="cm-variable">d3</span>.<span class="cm-property">timeFormat</span>(<span class="cm-string">&quot;%b&quot;</span>));
    <span class="cm-variable-2">svgSel</span>.<span class="cm-property">append</span>(<span class="cm-string">&quot;g&quot;</span>)
      .<span class="cm-property">attr</span>(<span class="cm-string">&quot;transform&quot;</span>, <span class="cm-string">&quot;translate(0, 275)&quot;</span>)
      .<span class="cm-property">call</span>(<span class="cm-variable-2">xAxis</span>);
  }
  <span class="cm-keyword">if</span>(<span class="cm-variable-2">yscale</span>){
    <span class="cm-variable">yDomain</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">extent</span>(<span class="cm-variable-2">maxPValues</span>.<span class="cm-property">concat</span>(<span class="cm-variable-2">maxNValues</span>));
    <span class="cm-variable-2">yscale</span>.<span class="cm-property">domain</span>(<span class="cm-variable">yDomain</span>);
    <span class="cm-comment">// Add yAxis</span>
    <span class="cm-keyword">let</span> <span class="cm-def">yAxis</span> <span class="cm-operator">=</span> <span class="cm-variable">d3</span>.<span class="cm-property">axisLeft</span>(<span class="cm-variable-2">yscale</span>)
      .<span class="cm-property">ticks</span>(<span class="cm-number">8</span>);
    <span class="cm-variable-2">svgSel</span>.<span class="cm-property">append</span>(<span class="cm-string">&quot;g&quot;</span>)
      .<span class="cm-property">attr</span>(<span class="cm-string">&quot;transform&quot;</span>, <span class="cm-string">&quot;translate(49, 0)&quot;</span>)
      .<span class="cm-property">call</span>(<span class="cm-variable-2">yAxis</span>);
  }
}
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">code</span><span class="cm-tag cm-bracket">&gt;</span>addAxis(svgSel, d, xscale, yscale, firstStack)<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">code</span><span class="cm-tag cm-bracket">&gt;</span></pre>

<p><a class="p_ident" id="p_JluKOccDLD" href="#p_JluKOccDLD" tabindex="-1" role="presentation"></a>Below is the function <code>addLabel</code> which is used to add text labels to our areas. If you need a refresher on areas see the previous section <a href="./05_04_areas.html">areas</a>.</p>

<pre class="snippet cm-s-default" data-language="html" data-edit="editable" data-cm="hidden" ><a class="c_ident" id="c_CsKCzvU9tj" href="#c_CsKCzvU9tj" tabindex="-1" role="presentation"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-keyword">function</span> <span class="cm-def">addLabels</span>(<span class="cm-def">selection</span>, <span class="cm-def">data</span>, <span class="cm-def">area</span>){
  <span class="cm-variable-2">selection</span>.<span class="cm-property">selectAll</span>(<span class="cm-string">&quot;.label&quot;</span>)
    .<span class="cm-property">data</span>(<span class="cm-variable-2">data</span>)
    .<span class="cm-property">join</span>(<span class="cm-string">&quot;text&quot;</span>)
    .<span class="cm-property">text</span>((<span class="cm-def">d</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">d</span>.<span class="cm-property">key</span>)
    .<span class="cm-property">attr</span>(<span class="cm-string">&quot;transform&quot;</span>, <span class="cm-variable">d3</span>.<span class="cm-property">areaLabel</span>(<span class="cm-variable-2">area</span>).<span class="cm-property">minHeight</span>(<span class="cm-number">9.5</span>))
    .<span class="cm-property">attr</span>(<span class="cm-string">&quot;fill&quot;</span>, <span class="cm-string">&quot;blaack&quot;</span>);
}
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">code</span><span class="cm-tag cm-bracket">&gt;</span>addLabels(selection, data, area)<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">code</span><span class="cm-tag cm-bracket">&gt;</span></pre></aside><nav><a href="05_05_areas.html" title="previous chapter">◀</a> <a href="index.html" title="cover">◆</a> <a href="05_07_arcs_pie_charts.html" title="next chapter">▶</a></nav>
</article>
<script src="js/ejs.js"></script>
